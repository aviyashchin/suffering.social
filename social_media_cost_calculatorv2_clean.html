<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RQ28MDK57K"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-RQ28MDK57K');
    </script>
    
    <!-- SEO Meta Tags -->
    <title>Social Media Impact Calculator | Economic Cost Analysis</title>
    <meta name="description" content="Research-based calculator estimating the economic and human costs of social media's impact on mental health, based on peer-reviewed studies and government data.">
    <meta name="keywords" content="social media cost calculator, mental health crisis economics, tech accountability tool, social media harm statistics, depression economic impact, suicide rates calculator, QALY social media, VSL calculator">
    <meta name="author" content="Subconscious.ai">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <link rel="canonical" href="https://www.suffering.social/social_media_cost_calculatorv2.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://socialmediaimpact.org/">
    <meta property="og:title" content="Social Media Impact Calculator | Economic Cost Analysis">
    <meta property="og:description" content="Research-based calculator estimating the economic and human costs of social media's impact on mental health, based on peer-reviewed studies and government data.">
    <meta property="og:image" content="https://socialmediaimpact.org/preview.png">
    <meta property="og:site_name" content="Suffering.Social">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://socialmediaimpact.org/">
    <meta property="twitter:title" content="Social Media Impact Calculator | Economic Cost Analysis">
    <meta property="twitter:description" content="Research-based calculator estimating the economic and human costs of social media's impact on mental health, based on peer-reviewed studies and government data.">
    <meta property="twitter:image" content="https://socialmediaimpact.org/preview.png">
    <meta name="twitter:creator" content="@subconsciousai">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    
    <!-- Performance Optimizations: DNS Prefetch & Preconnect -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//www.googletagmanager.com">
    
    <!-- External Libraries with Performance Optimizations -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" 
          rel="stylesheet"
          crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" 
            defer
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js" 
            defer></script>
    
    <!-- Tippy.js for Professional Tooltips -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2/dist/umd/popper.min.js" 
            defer></script>
    <script src="https://cdn.jsdelivr.net/npm/tippy.js@6/dist/tippy-bundle.umd.js" 
            defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tippy.js@6/themes/light-border.css">
    
    <!-- Professional Libraries for Enhanced Functionality -->
    <!-- noUiSlider - Professional range sliders -->
    <link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css" 
          rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js" 
            defer></script>
    
    <!-- Anime.js - Professional animations -->
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" 
            defer></script>
    
    <!-- Lodash - Utility functions -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js" 
            defer></script>
    
    <!-- Web Vitals - Performance monitoring -->
    <script src="https://cdn.jsdelivr.net/npm/web-vitals@3.5.2/dist/web-vitals.umd.js" 
            defer></script>
    
    <!-- Clean CSS Architecture -->
    <style>
        :root {
            /* Color System */
            --color-primary: #1f2937;
            --color-primary-light: #374151;
            --color-secondary: #3b82f6;
            --color-accent: #ef4444;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            
            /* Text Colors */
            --color-text-primary: #111827;
            --color-text-secondary: #6b7280;
            --color-text-light: #9ca3af;
            --color-text-white: #ffffff;
            
            /* Background Colors */
            --color-bg-primary: #ffffff;
            --color-bg-secondary: #f9fafb;
            --color-bg-tertiary: #f3f4f6;
            --color-bg-dark: #1f2937;
            
            /* Typography */
            --font-family-primary: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Z-index Scale */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
        }
        
        /* Reset and Base Styles */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family-primary);
            color: var(--color-text-primary);
            background-color: var(--color-bg-secondary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding-top: 5rem; /* Space for fixed header */
        }
        
        /* Fixed Header */
        .header-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: var(--z-fixed);
            background: linear-gradient(to right, var(--color-primary), var(--color-primary-light));
            color: var(--color-text-white);
            box-shadow: var(--shadow-lg);
        }
        
        /* Component Styles */
        .card {
            background: var(--color-bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-weight: 600;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background-color: var(--color-secondary);
            color: var(--color-text-white);
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-0.5px);
        }
        
        .btn-danger {
            background-color: var(--color-danger);
            color: var(--color-text-white);
        }
        
        .btn-danger:hover {
            background-color: #dc2626;
        }
        
        /* Slider Styles */
        .slider {
            width: 100%;
            height: 0.5rem;
            border-radius: var(--radius-md);
            background: var(--color-bg-tertiary);
            outline: none;
            transition: all 0.2s ease;
        }
        
        .slider:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Parameter Groups */
        .parameter-group {
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--color-bg-primary);
            border-radius: var(--radius-xl);
            border-left: 4px solid;
        }
        
        .parameter-group.mortality {
            border-left-color: var(--color-danger);
        }
        
        .parameter-group.mental-health {
            border-left-color: #8b5cf6;
        }
        
        .parameter-group.productivity {
            border-left-color: var(--color-success);
        }
        
        /* Fixed Elements */
        .fixed-help {
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            z-index: var(--z-fixed);
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background-color: var(--color-danger);
            color: var(--color-text-white);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: all 0.2s ease;
        }
        
        .fixed-help:hover {
            background-color: #dc2626;
            transform: scale(1.1);
        }
        
        .fixed-branding {
            position: fixed;
            bottom: var(--spacing-lg);
            left: var(--spacing-lg);
            z-index: var(--z-fixed);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            font-size: 0.75rem;
        }
        
        /* Info Buttons - consolidated below with advanced tooltip system */
        
        /* Help Modal */
        .help-modal {
            position: fixed;
            bottom: 5rem;
            right: var(--spacing-lg);
            z-index: var(--z-modal);
            background: var(--color-bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--color-bg-tertiary);
            max-width: 20rem;
            width: 20rem;
            padding: var(--spacing-lg);
            transform: translateY(1rem);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .help-modal.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .help-modal h3 {
            margin: 0 0 var(--spacing-sm) 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--color-text-primary);
        }
        
        .help-modal p {
            margin: 0 0 var(--spacing-sm) 0;
            font-size: 0.875rem;
            color: var(--color-text-secondary);
            line-height: 1.5;
        }
        
        .help-modal-close {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--color-text-light);
            cursor: pointer;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Tooltip */
        .tooltip {
            position: fixed;
            z-index: var(--z-tooltip);
            background: var(--color-text-primary);
            color: var(--color-text-white);
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            max-width: 16rem;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-lg);
        }
        
        .tooltip.show {
            opacity: 1;
            visibility: visible;
        }
        
        .tooltip a {
            color: #93c5fd;
            text-decoration: underline;
        }
        
        .tooltip a:hover {
            color: #dbeafe;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 4rem;
            }
            
            .fixed-help,
            .fixed-branding {
                bottom: var(--spacing-md);
            }
            
            .fixed-help {
                right: var(--spacing-md);
                width: 3rem;
                height: 3rem;
                font-size: 1.25rem;
            }
            
            .fixed-branding {
                left: var(--spacing-md);
            }
        }
        
        /* Performance Mode */
        .performance-mode * {
            animation: none !important;
            transition: opacity 0.3s ease, visibility 0.3s ease !important;
        }
        
        .performance-mode .card {
            box-shadow: var(--shadow-sm);
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus Indicators */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible {
            outline: 2px solid var(--color-secondary);
            outline-offset: 2px;
        }
        
        /* Hide loading state after page loads */
        .loading {
            opacity: 0;
            transition: opacity 0.8s ease-out;
        }
        
        .loaded {
            opacity: 1;
        }
        
        /* Hero section animations */
        .hero-hidden {
            opacity: 0;
            transform: translateY(2rem);
            transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hero-visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Refined Distribution Visualizations - Subtle & Professional */
        .distribution-viz {
            height: 100px;
            width: 100%;
            background: #fafbfc;
            border: 1px solid #e5e7eb;
            border-radius: var(--radius-md);
            margin-top: var(--spacing-sm);
            overflow: hidden;
            position: relative;
            box-sizing: border-box;
            min-width: 100%;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        /* Subtle color coding by parameter type */
        .parameter-group.mortality .distribution-viz {
            border-left: 2px solid #dc2626;
            background: #fefefe;
        }
        
        .parameter-group.mental-health .distribution-viz {
            border-left: 2px solid #7c3aed;
            background: #fefefe;
        }
        
        .parameter-group.productivity .distribution-viz {
            border-left: 2px solid #059669;
            background: #fefefe;
        }
        
        /* Subtle hover effects */
        .distribution-viz:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border-color: #d1d5db;
        }
        
        .parameter-group.mortality .distribution-viz:hover {
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.1);
        }
        
        .parameter-group.mental-health .distribution-viz:hover {
            box-shadow: 0 4px 8px rgba(124, 58, 237, 0.1);
        }
        
        .parameter-group.productivity .distribution-viz:hover {
            box-shadow: 0 4px 8px rgba(5, 150, 105, 0.1);
        }
        
        .distribution-viz svg {
            width: 100%;
            height: 100%;
            display: block;
            min-width: 100%;
        }
        
        /* Refined current value indicator */
        .distribution-viz .current-value {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1.5px;
            background: #dc2626;
            z-index: 10;
            box-shadow: 0 0 2px rgba(220, 38, 38, 0.3);
            transition: all 0.15s ease;
        }
        
        .distribution-viz:hover .current-value {
            width: 2px;
            box-shadow: 0 0 3px rgba(220, 38, 38, 0.4);
        }
        
        /* User-friendly distribution info */
        .distribution-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            margin-top: 6px;
            font-family: var(--font-family-primary);
            line-height: 1.3;
        }
        
        /* Subtle updating state */
        .distribution-viz.updating {
            opacity: 0.85;
            transition: opacity 0.1s ease;
        }
        
        .distribution-viz.updating::after {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #6b7280;
            z-index: 20;
            animation: pulse 1s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }
        
        /* Make sure sliders and distribution charts align perfectly */
        .slider {
            width: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Container alignment */
        .parameter-group .mb-6 {
            width: 100%;
        }
        
        /* Hero Section Enhancements */
        #hero-section {
            background-attachment: fixed;
            will-change: transform;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Smooth transitions */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
        
        /* Enhanced gradient text */
        .bg-clip-text {
            background-clip: text;
            -webkit-background-clip: text;
        }
        
        /* Scroll indicator animation */
        @keyframes scroll-bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        .animate-bounce {
            animation: scroll-bounce 2s infinite;
        }
        
        /* Cinematic fade */
        .cinematic-fade {
            background: linear-gradient(to bottom, transparent 0%, rgba(249, 250, 251, 0.9) 70%, rgb(249, 250, 251) 100%);
        }
        
        /* Hero section scroll behavior fix */
        #hero-section {
            position: relative;
            z-index: 1;
        }
        
        #calculator-start {
            position: relative;
            z-index: 2;
            background-color: var(--color-bg-secondary);
        }
        
        /* Parallax scroll optimization */
        .parallax-optimized {
            will-change: transform;
            backface-visibility: hidden;
        }
        
        /* Enhanced Info Button System with Tippy.js */
        .info-button {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: none;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-family-primary);
            box-shadow: var(--shadow-sm);
            margin-left: 0.5rem;
        }
        
        .info-button.mortality {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
        }
        
        .info-button.mental-health {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }
        
        .info-button.productivity {
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
        }
        
        .info-button:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }
        
        .info-button:active {
            transform: scale(0.98);
        }
        
        /* Tippy.js Custom Styling */
        .tippy-box[data-theme~='research'] {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            max-width: 400px;
        }
        
        .tippy-box[data-theme~='research'] .tippy-content {
            padding: 1rem;
        }
        
        .tippy-box[data-theme~='research'] .tippy-arrow {
            color: white;
        }
        
        .research-content h4 {
            margin: 0 0 0.75rem 0;
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .research-content .study {
            margin: 0.75rem 0;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 3px solid;
        }
        
        .research-content .study.mortality {
            border-left-color: #dc2626;
        }
        
        .research-content .study.mental-health {
            border-left-color: #8b5cf6;
        }
        
        .research-content .study.productivity {
            border-left-color: #16a34a;
        }
        
        .research-content .study-title {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--color-text-primary);
            margin-bottom: 0.25rem;
        }
        
        .research-content .study-authors {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .research-content .study-finding {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .research-content .study-finding.mortality {
            color: #dc2626;
        }
        
        .research-content .study-finding.mental-health {
            color: #8b5cf6;
        }
        
        .research-content .study-finding.productivity {
            color: #16a34a;
        }
        
        .research-content .study-method {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            font-style: italic;
        }
        
        .research-content .study-link {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: var(--color-secondary);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.75rem;
            transition: background-color 0.2s ease;
        }
        
        .research-content .study-link:hover {
            background: #2563eb;
        }
        
        /* Interactive Citation System Styling */
        .clickable-citation {
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .clickable-citation:hover {
            background-color: #f0f9ff;
            border-left-color: #3b82f6;
            transform: translateX(3px);
        }
        
        .citation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }
        
        .confidence-badge {
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            flex-shrink: 0;
        }
        
        .confidence-very-high {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        
        .confidence-high {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        
        .confidence-medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .confidence-low {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .citation-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            align-items: center;
        }
        
        .apply-values-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .apply-values-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
        }
        
        .citation-instructions {
            text-align: center;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background: #f0f9ff;
            border-radius: 6px;
            border: 1px solid #bfdbfe;
        }
        
        .citation-instructions small {
            color: #1d4ed8;
            font-weight: 500;
        }
        
        .citation-applied {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0) !important;
            border-left-color: #22c55e !important;
            animation: citationApplied 0.5s ease-out;
        }
        
        @keyframes citationApplied {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 0 0 8px rgba(34, 197, 94, 0.1);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
            }
        }
        
        .study-finding {
            font-weight: 600;
            margin: 0.5rem 0;
        }
        
        /* Parameter-specific citation highlighting */
        .study.mortality .study-finding {
            color: #dc2626;
        }
        
        .study.mental-health .study-finding {
            color: #8b5cf6;
        }
        
        .study.productivity .study-finding {
            color: #16a34a;
        }
        
        /* Enhanced Mobile Experience */
        @media (max-width: 768px) {
            .info-button {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }
            
            .tippy-box[data-theme~='research'] {
                max-width: 90vw;
                font-size: 13px;
            }
            
            .citation-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
            
            .citation-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .apply-values-btn {
                width: 100%;
                text-align: center;
            }
            
            /* Optimized distributions for mobile */
            .distribution-viz {
                height: 80px;
                margin-top: 0.5rem;
            }
            
            .distribution-info {
                font-size: 0.625rem;
                line-height: 1.2;
                flex-direction: column;
                gap: 2px;
            }
            
            .distribution-viz:hover {
                transform: none;
                box-shadow: none;
            }
        }
        
        /* Professional Third-Party Library Styling */
        
        /* noUiSlider Professional Theme System */
        .nouislider-container {
            margin: 1rem 0;
            padding: 0.5rem 0;
        }
        
        .noUi-target {
            background: #e5e7eb;
            border-radius: 8px;
            border: none;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            height: 14px;
            margin: 1rem 0 2rem 0;
        }
        
        .noUi-base {
            height: 100%;
            position: relative;
        }
        
        .noUi-handle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.2s ease;
            outline: none;
            top: -5px;
            right: -12px;
        }
        
        .noUi-handle:before,
        .noUi-handle:after {
            display: none;
        }
        
        .noUi-handle:hover {
            transform: scale(1.03);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }
        
        .noUi-handle:active {
            transform: scale(1.02);
        }
        
        /* Theme-specific colors */
        .nouislider-container.mortality .noUi-handle {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .nouislider-container.mortality .noUi-connect {
            background: linear-gradient(90deg, #dc2626, #ef4444);
        }
        
        .nouislider-container.mental-health .noUi-handle {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .nouislider-container.mental-health .noUi-connect {
            background: linear-gradient(90deg, #8b5cf6, #a855f7);
        }
        
        .nouislider-container.productivity .noUi-handle {
            background: linear-gradient(135deg, #16a34a, #15803d);
        }
        
        .nouislider-container.productivity .noUi-connect {
            background: linear-gradient(90deg, #16a34a, #22c55e);
        }
        
        /* Professional tooltips */
        .noUi-tooltip {
            background: rgba(0, 0, 0, 0.85);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.375rem 0.75rem;
            font-family: var(--font-family-mono);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(8px);
        }
        
        .noUi-tooltip:before {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid rgba(0, 0, 0, 0.85);
        }
        
        /* Fallback slider styling */
        .fallback-slider {
            width: 100%;
            height: 14px;
            border-radius: 8px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
            margin: 1rem 0 2rem 0;
        }
        
        .fallback-slider::-webkit-slider-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-secondary), #2563eb);
            border: 3px solid white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            -webkit-appearance: none;
        }
        
        .fallback-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-secondary), #2563eb);
            border: 3px solid white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            cursor: pointer;
        }
        
        /* Animation Enhancement Classes */
        .animate-enhanced {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .animate-bounce-subtle {
            animation: bounceSubtle 0.6s ease-out;
        }
        
        @keyframes bounceSubtle {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-4px); }
            60% { transform: translateY(-2px); }
        }
        
        /* Performance Monitoring Display */
        .performance-metrics {
            position: fixed;
            top: 5rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-family: monospace;
            z-index: var(--z-tooltip);
            display: none;
        }
        
        .performance-metrics.show {
            display: block;
        }
        
        /* Performance metric color coding */
        .performance-good {
            color: #22c55e;
            font-weight: 600;
        }
        
        .performance-needs-improvement {
            color: #f59e0b;
            font-weight: 600;
        }
        
        .performance-poor {
            color: #ef4444;
            font-weight: 600;
        }
    </style>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Social Media Impact Calculator",
        "description": "Research-based calculator estimating the economic and human costs of social media's impact on mental health",
        "url": "https://socialmediaimpact.org/",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Web Browser",
        "author": {
            "@type": "Organization",
            "name": "Subconscious.ai",
            "url": "https://subconscious.ai"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "keywords": "social media, mental health, economic impact, calculator, research, depression, suicide, healthcare costs",
        "isAccessibleForFree": true,
        "datePublished": "2024-12-01",
        "dateModified": "2024-12-01"
    }
    </script>
</head>
<body class="loading performance-mode">
    <!-- Fixed Header -->
    <header class="header-fixed">
        <div class="flex flex-col items-center justify-center gap-2 sm:gap-4 w-full max-w-6xl mx-auto px-4 py-4">
            <div class="text-xs sm:text-sm text-gray-300 uppercase tracking-wide">
                Total Social Media Cost (Est. Since 2009)
            </div>
            <div class="text-2xl sm:text-4xl md:text-5xl font-mono font-bold text-red-400 flex items-baseline gap-2">
                <span class="text-xl sm:text-3xl md:text-4xl">$</span>
                <span id="total-amount">2,481,760,000,000</span>
            </div>
            <div class="text-sm sm:text-base text-gray-200">and counting‚Ä¶</div>
        </div>
    </header>

        <!-- Main Content -->
    <main class="container max-w-7xl mx-auto px-4 py-8" style="margin-top: 2rem;">
        <!-- Cinematic Hero Transition -->
        <section class="relative min-h-screen flex items-center justify-center mb-16 overflow-hidden" id="hero-section">
            <!-- Video Background Placeholder -->
            <div class="absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-blue-900">
                <!-- Replace this div with actual video when ready -->
                <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMSIgZmlsbD0iIzM3NDE1MSIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KPHN2Zz4K')] opacity-20"></div>
            </div>
            
            <!-- Overlay Content -->
            <div class="relative z-10 text-center px-6 max-w-5xl mx-auto">
                <div class="hero-hidden" id="hero-content">
                    <h1 class="text-5xl lg:text-7xl font-bold mb-6 text-white leading-tight">
                        The Hidden
                        <span class="bg-gradient-to-r from-red-400 to-pink-400 bg-clip-text text-transparent">
                            Cost
                        </span>
                        <br>
                        of Progress
                    </h1>
                    <p class="text-xl lg:text-2xl text-gray-300 mb-8 leading-relaxed">
                        What happens when innovation sacrifices human wellbeing?
                        <br>
                        <span class="text-gray-400">We measured the unmeasurable.</span>
                    </p>
                    
                    <!-- Scroll Indicator -->
                    <div class="mt-12 opacity-0 transition-opacity duration-1000 delay-1000" id="scroll-indicator">
                        <div class="inline-flex flex-col items-center text-gray-400 cursor-pointer transition-transform hover:scale-110" onclick="smoothScrollToCalculator()">
                            <span class="text-sm uppercase tracking-wider mb-2">Explore the Data</span>
                            <div class="w-6 h-10 border-2 border-gray-400 rounded-full flex justify-center">
                                <div class="w-1 h-3 bg-gray-400 rounded-full mt-2 animate-bounce"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gradient Fade to Content -->
            <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-gray-50 to-transparent z-20"></div>
        </section>

        <!-- Beyond GDP: Measuring What Matters -->
        <section class="bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 rounded-3xl p-8 lg:p-12 mb-12 text-white shadow-2xl" id="calculator-start">
            <div class="text-center mb-8">
                <h1 class="text-3xl lg:text-5xl font-bold mb-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                    The Unmeasured <span class="text-red-400" id="hero-total-cost">$2.48 Trillion</span>
                </h1>
                <p class="text-lg lg:text-xl text-blue-100 max-w-4xl mx-auto" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                    Economic externalities hidden from GDP ‚Äî the true cost of human suffering, lost potential, and broken social bonds
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                <div class="bg-blue-800/30 backdrop-blur-sm rounded-2xl p-6 border border-blue-400/30 shadow-xl">
                    <div class="text-4xl mb-4">üß†</div>
                    <h3 class="text-xl font-bold mb-2">Mental Wellbeing</h3>
                    <p class="text-blue-100 text-sm">Freedom from anxiety, depression, and digital addiction</p>
                </div>
                
                <div class="bg-teal-800/30 backdrop-blur-sm rounded-2xl p-6 border border-teal-400/30 shadow-xl">
                    <div class="text-4xl mb-4">ü§ù</div>
                    <h3 class="text-xl font-bold mb-2">Social Connection</h3>
                    <p class="text-teal-100 text-sm">Meaningful relationships and community bonds</p>
                </div>
                
                <div class="bg-purple-800/30 backdrop-blur-sm rounded-2xl p-6 border border-purple-400/30 shadow-xl">
                    <div class="text-4xl mb-4">üíú</div>
                    <h3 class="text-xl font-bold mb-2">Life Satisfaction</h3>
                    <p class="text-purple-100 text-sm">Purpose, fulfillment, and genuine happiness</p>
                </div>
                
                <div class="bg-orange-800/30 backdrop-blur-sm rounded-2xl p-6 border border-orange-400/30 shadow-xl">
                    <div class="text-4xl mb-4">üõ°Ô∏è</div>
                    <h3 class="text-xl font-bold mb-2">Personal Autonomy</h3>
                    <p class="text-orange-100 text-sm">Freedom from manipulation and surveillance</p>
                </div>
            </div>
            
            <div class="text-center">
                <h2 class="text-2xl lg:text-4xl font-bold mb-6" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                    It's time to measure what truly matters
                </h2>
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20 max-w-4xl mx-auto">
                    <p class="text-lg lg:text-xl text-blue-100" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                        GDP captures income, but misses the essence of human flourishing. We must quantify the hidden costs ‚Äî 
                        the mental health crises, broken social bonds, and lost purpose that make life truly rich.
                        <strong class="text-yellow-300"> Let's build an economy that optimizes for wellbeing, not just wealth.</strong>
                    </p>
                </div>
            </div>
            
            <div class="mt-8 text-center">
                <div class="inline-flex items-center gap-3 bg-gray-900/60 backdrop-blur-sm rounded-full px-6 py-3 border border-gray-400/30">
                    <span class="text-2xl font-bold">Beyond GDP.</span>
                    <span class="text-gray-300 text-xl">Reclaiming what matters.</span>
                </div>
            </div>
        </section>
        
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Calculator Column -->
            <section class="lg:col-span-2">
                <div class="card">
                    <!-- Calculator Header -->
                    <div class="bg-gradient-to-r from-gray-700 to-gray-800 text-white p-8 text-center">
                        <h1 class="text-2xl font-semibold mb-2">Interactive Cost Calculator</h1>
                        <p class="text-base mb-4">Simple formulas showing cumulative costs since 2009</p>
                        
                        <!-- Scenario Buttons -->
                        <div class="grid grid-cols-2 gap-3 max-w-md mx-auto">
                            <button class="btn btn-primary scenario-btn" data-scenario="reset">
                                üî¨ Research Consensus
                            </button>
                            <button class="btn btn-danger scenario-btn" data-scenario="aggressive">
                                üö® Worst Case
                            </button>
                            <button class="btn scenario-btn" style="background: #8b5cf6; color: white;" data-scenario="facebook-files">
                                üì± Facebook Files
                            </button>
                            <button class="btn scenario-btn" style="background: #10b981; color: white;" data-scenario="optimistic">
                                üåü Optimistic
                            </button>
                        </div>
                    </div>
                    
                    <!-- Calculator Body -->
                    <div class="p-8">
                        <!-- Mortality Parameters -->
                        <div class="parameter-group mortality">
                            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <button class="info-button mortality" data-tooltip="mortality" aria-label="Research information">i</button>
                                ‚ò†Ô∏è Death
                            </h2>
                            
                            <!-- Research Context -->
                            <div class="bg-blue-50 text-blue-900 rounded-xl p-5 mb-6 border border-blue-200">
                                <p class="font-medium">Mortality Statistics</p>
                                <div class="mt-3 grid grid-cols-2 gap-4 text-sm">
                                    <div class="bg-white p-3 rounded-lg border">
                                        <div class="text-2xl font-bold text-red-600">49,000+</div>
                                        <div class="text-xs text-gray-600">Deaths by suicide in the U.S. (2023)</div>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg border">
                                        <div class="text-2xl font-bold text-orange-600">37%</div>
                                        <div class="text-xs text-gray-600">Increase in suicide rates (2000-2022)</div>
                                    </div>
                                </div>
                                <p class="mt-3 text-xs text-gray-600">
                                    Source: <a href="https://www.cdc.gov/suicide/facts/index.html" target="_blank" class="text-indigo-600 underline">CDC National Vital Statistics System, 2023</a>
                                </p>
                            </div>
                            
                            <!-- VSL Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Value of Statistical Life (VSL)
                                        <button class="info-button mortality" data-tooltip="mortality-vsl" aria-label="VSL Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold text-red-600" id="vsl-value">$13.7M</span>
                                </div>
                                <input type="range" min="8" max="20" value="13.7" step="0.1" class="slider" id="vsl-slider">
                                <div class="distribution-viz" id="vsl-distribution">
                                    <div class="current-value" id="vsl-current"></div>
                                    <svg id="vsl-svg"></svg>
                                </div>
                                <div class="distribution-info" id="vsl-info">
                                    <span>Normal Distribution | Mean: $13.7M | Median: $13.5M | 95% CI: [$10.2M, $17.8M]</span>
                                </div>
                            </div>
                            
                            <!-- Suicides Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Excess Suicides Since 2009 (P)
                                        <button class="info-button mortality" data-tooltip="mortality-suicides" aria-label="Suicides Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold text-red-600" id="suicides-value">110K</span>
                                </div>
                                <input type="range" min="100000" max="300000" value="110000" step="1000" class="slider" id="suicides-slider">
                                <div class="distribution-viz" id="suicides-distribution">
                                    <div class="current-value" id="suicides-current"></div>
                                    <svg id="suicides-svg"></svg>
                                </div>
                                <div class="distribution-info" id="suicides-info">
                                    <span>Gamma Distribution | Mean: 110K | Median: 105K | 95% CI: [85K, 140K]</span>
                                </div>
                            </div>
                            
                            <!-- Attribution Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        % Attributable to Social Media (Q)
                                        <button class="info-button mortality" data-tooltip="mortality-attribution" aria-label="Attribution Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold text-red-600" id="attribution-value">18%</span>
                                </div>
                                <input type="range" min="5" max="30" value="18" step="1" class="slider" id="attribution-slider">
                                <div class="distribution-viz" id="attribution-distribution">
                                    <div class="current-value" id="attribution-current"></div>
                                    <svg id="attribution-svg"></svg>
                                </div>
                                <div class="distribution-info" id="attribution-info">
                                    <span>Beta Distribution | Mean: 18% | Median: 17% | 95% CI: [12%, 25%]</span>
                                </div>
                            </div>
                            
                            <!-- Formula Display -->
                            <div class="bg-red-50 border border-red-300 rounded-lg p-4 font-mono text-sm">
                                <strong>‚ò†Ô∏è Death Formula:</strong> P √ó Q √ó VSL<br>
                                <strong>Result:</strong> <span id="mortality-result">110,000 √ó 18% √ó $13.7M = $271.3B</span>
                            </div>
                        </div>
                        
                        <!-- Mental Health Parameters -->
                        <div class="parameter-group mental-health">
                            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2" style="color: #8b5cf6;">
                                <button class="info-button mental-health" data-tooltip="mental-health" aria-label="Research information">i</button>
                                üòû Disability
                            </h2>
                            
                            <!-- Research Context -->
                            <div class="bg-purple-50 text-purple-900 rounded-xl p-5 mb-6 border border-purple-200">
                                <p class="font-medium">Mental Health Impact</p>
                                <div class="mt-3 grid grid-cols-2 gap-4 text-sm">
                                    <div class="bg-white p-3 rounded-lg border">
                                        <div class="text-2xl font-bold text-purple-600">15.8%</div>
                                        <div class="text-xs text-gray-600">Teens with major depression (2019)</div>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg border">
                                        <div class="text-2xl font-bold text-blue-600">5.2M</div>
                                        <div class="text-xs text-gray-600">U.S. teens with major depressive episode (2024)</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Depression Cases Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Americans with Social Media (SM)-Induced Depression (P)
                                        <button class="info-button mental-health" data-tooltip="qaly-people" aria-label="Depression Cases Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold" style="color: #8b5cf6;" id="depression-value">5.0M</span>
                                </div>
                                <input type="range" min="3000000" max="15000000" value="5000000" step="100000" class="slider" id="depression-slider">
                                <div class="distribution-viz" id="depression-distribution">
                                    <div class="current-value" id="depression-current"></div>
                                    <svg id="depression-svg"></svg>
                                </div>
                                <div class="distribution-info" id="depression-info">
                                    <span>Log-Normal Distribution | Mean: 5.0M | Median: 4.8M | 95% CI: [3.2M, 7.8M]</span>
                                </div>
                            </div>
                            
                            <!-- YLD Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Years Lived with Disability (Q)
                                        <button class="info-button mental-health" data-tooltip="qaly-yld" aria-label="YLD Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold" style="color: #8b5cf6;" id="yld-value">6.0 years</span>
                                </div>
                                <input type="range" min="4" max="8" value="6" step="0.1" class="slider" id="yld-slider">
                                <div class="distribution-viz" id="yld-distribution">
                                    <div class="current-value" id="yld-current"></div>
                                    <svg id="yld-svg"></svg>
                                </div>
                                <div class="distribution-info" id="yld-info">
                                    <span>Normal Distribution | Mean: 6.0 years | Median: 6.0 years | 95% CI: [5.0, 7.0 years]</span>
                                </div>
                            </div>
                            
                            <!-- QOL Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Quality of Life Reduction (R)
                                        <button class="info-button mental-health" data-tooltip="qaly-qol" aria-label="QOL Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold" style="color: #8b5cf6;" id="qol-value">35%</span>
                                </div>
                                <input type="range" min="30" max="40" value="35" step="1" class="slider" id="qol-slider">
                                <div class="distribution-viz" id="qol-distribution">
                                    <div class="current-value" id="qol-current"></div>
                                    <svg id="qol-svg"></svg>
                                </div>
                                <div class="distribution-info" id="qol-info">
                                    <span>Beta Distribution | Mean: 35% | Median: 35% | 95% CI: [31%, 39%]</span>
                                </div>
                            </div>
                            
                            <!-- Formula Display -->
                            <div class="bg-purple-50 border border-purple-300 rounded-lg p-4 font-mono text-sm">
                                <strong>üòû Disability Formula:</strong> P √ó Q √ó R √ó (VSL √∑ 75 years)<br>
                                <strong>Result:</strong> <span id="mental-result">5M √ó 6 √ó 35% √ó $182K = $1.92T</span>
                            </div>
                        </div>
                        
                        <!-- Productivity Parameters -->
                        <div class="parameter-group productivity">
                            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2 text-green-700">
                                <button class="info-button productivity" data-tooltip="productivity" aria-label="Research information">i</button>
                                üí∏ Lost Productivity
                            </h2>
                            
                            <!-- Research Context -->
                            <div class="bg-green-50 text-green-900 rounded-xl p-5 mb-6 border border-green-200">
                                <p class="font-medium">Economic Impact</p>
                                <div class="mt-3 grid grid-cols-2 gap-4 text-sm">
                                    <div class="bg-white p-3 rounded-lg border">
                                        <div class="text-2xl font-bold text-green-600">$282B</div>
                                        <div class="text-xs text-gray-600">Annual cost of mental illness to U.S. economy</div>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg border">
                                        <div class="text-2xl font-bold text-orange-600">$47.6B</div>
                                        <div class="text-xs text-gray-600">Annual mental health productivity losses</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Healthcare Costs Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Annual Healthcare Costs (P)
                                        <button class="info-button productivity" data-tooltip="healthcare-costs" aria-label="Healthcare Costs Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold text-green-600" id="healthcare-value">$7,000</span>
                                </div>
                                <input type="range" min="6500" max="20000" value="7000" step="100" class="slider" id="healthcare-slider">
                                <div class="distribution-viz" id="healthcare-distribution">
                                    <div class="current-value" id="healthcare-current"></div>
                                    <svg id="healthcare-svg"></svg>
                                </div>
                                <div class="distribution-info" id="healthcare-info">
                                    <span>Log-Normal Distribution | Mean: $7.0K | Median: $6.8K | 95% CI: [$6.5K, $8.2K]</span>
                                </div>
                            </div>
                            
                            <!-- Productivity Loss Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Annual Productivity Loss per Person (Q)
                                        <button class="info-button productivity" data-tooltip="healthcare-productivity" aria-label="Productivity Loss Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold text-green-600" id="productivity-value">$6,000</span>
                                </div>
                                <input type="range" min="6000" max="10000" value="6000" step="100" class="slider" id="productivity-slider">
                                <div class="distribution-viz" id="productivity-distribution">
                                    <div class="current-value" id="productivity-current"></div>
                                    <svg id="productivity-svg"></svg>
                                </div>
                                <div class="distribution-info" id="productivity-info">
                                    <span>Gamma Distribution | Mean: $6.0K | Median: $5.9K | 95% CI: [$6.0K, $7.5K]</span>
                                </div>
                            </div>
                            
                            <!-- Duration Slider -->
                            <div class="mb-6">
                                <div class="flex justify-between mb-2 font-medium">
                                    <span class="flex items-center gap-2">
                                        Treatment Duration in Years (R)
                                        <button class="info-button productivity" data-tooltip="healthcare-duration" aria-label="Duration Research information">i</button>
                                    </span>
                                    <span class="font-mono font-bold text-green-600" id="duration-value">4.5 years</span>
                                </div>
                                <input type="range" min="3" max="6" value="4.5" step="0.1" class="slider" id="duration-slider">
                                <div class="distribution-viz" id="duration-distribution">
                                    <div class="current-value" id="duration-current"></div>
                                    <svg id="duration-svg"></svg>
                                </div>
                                <div class="distribution-info" id="duration-info">
                                    <span>Normal Distribution | Mean: 4.5 years | Median: 4.5 years | 95% CI: [3.7, 5.3 years]</span>
                                </div>
                            </div>
                            
                            <!-- Formula Display -->
                            <div class="bg-green-50 border border-green-300 rounded-lg p-4 font-mono text-sm">
                                <strong>üí∏ Lost Productivity Formula:</strong> Depressed Americans √ó (Healthcare + Productivity) √ó Duration<br>
                                <strong>Result:</strong> <span id="healthcare-result">5M √ó ($7K + $6K) √ó 4.5 = $292.5B</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Results Column -->
            <aside class="lg:col-span-1">
                <div class="card p-8 mb-8">
                    <!-- Total Display -->
                    <div class="text-center p-8 bg-gradient-to-r from-gray-800 to-gray-700 text-white rounded-xl mb-8">
                        <div class="text-4xl font-bold text-red-400 mb-2" id="total-cost">$2.48 Trillion</div>
                        <p class="text-lg">Total Economic Cost to Society</p>
                        <p class="text-sm mt-2 opacity-90">
                            <span id="gdp-percentage">2.4%</span> of US GDP ($24T)
                        </p>
                    </div>
                    
                    <!-- Running Counter -->
                    <div class="bg-gradient-to-r from-gray-800 to-gray-700 text-white rounded-xl p-6 mb-8 text-center">
                        <div class="text-2xl font-bold text-red-400 mb-2 font-mono" id="running-total">$0</div>
                        <div class="text-sm opacity-90">Cost Generated Since Page Load</div>
                    </div>
                    

                    
                    <!-- Charts -->
                    <div class="space-y-8">
                        <!-- Causal Pathway Diagram -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4">üîó Research-Based Causal Pathway</h3>
                            <div class="text-sm text-gray-600 mb-4">
                                Click to expand the full causal diagram showing how social media leads to economic impacts.
                            </div>
                            <div class="bg-blue-50 rounded-xl p-4 cursor-pointer hover:shadow-lg transition-shadow" id="causal-diagram-preview" onclick="document.getElementById('causal-modal').classList.remove('hidden')">
                                <div class="mermaid text-xs" id="causal-preview">
                                    graph LR
                                    A["üì± Social Media"] --> B["üß† Mental Health"]
                                    B --> C["üí∞ Economic Impact"]
                                    
                                    style A fill:#ff6b6b,color:#fff
                                    style B fill:#f39c12,color:#fff  
                                    style C fill:#e74c3c,color:#fff
                                </div>
                                <div class="text-center mt-2 text-blue-600 font-medium">Click to see full research pathway ‚Üí</div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">üìà Cost Component Progression Since 2009</h3>
                            <div class="text-sm text-gray-600 mb-4">
                                Shows how each cost component has accumulated over time, reflecting gradual social media adoption, research documentation, and pandemic amplification effects.
                            </div>
                            <div class="h-64">
                                <canvas id="timeline-chart"></canvas>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">üìä Cost Composition</h3>
                            <div class="h-64">
                                <canvas id="pie-chart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Enhanced Features Section (moved below charts) -->
                        <div class="enhanced-features">
                            <!-- Uncertainty Analysis -->
                            <div id="uncertainty-analysis" class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8">
                                <h3 class="text-lg font-semibold text-blue-800 mb-4 flex items-center gap-2">
                                    üìä Uncertainty Analysis
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium">ENHANCED</span>
                                </h3>
                                <div class="text-sm text-blue-700 mb-4">
                                    Distribution sliders provide confidence intervals showing the range of plausible outcomes based on research uncertainty.
                                </div>
                                <div id="uncertainty-range" class="bg-white rounded-lg p-4 border-l-4 border-blue-500">
                                    <div class="text-sm text-gray-600">
                                        Adjust sliders to see how uncertainty affects total cost estimates...
                                    </div>
                                </div>
                            </div>

                            <!-- Integration Status -->
                            <div id="integration-status" class="bg-green-50 border border-green-200 rounded-lg p-4 mb-8">
                                <h4 class="font-semibold text-green-800 mb-2 flex items-center gap-2">
                                    ‚ú® Enhanced Calculator Active
                                </h4>
                                <div class="text-sm text-green-700">
                                    You're using distribution sliders with mathematical uncertainty visualization.
                                </div>
                                <div id="feature-list" class="mt-2 text-xs text-green-600">
                                    ‚Ä¢ Mathematical distribution curves<br>
                                    ‚Ä¢ Real-time confidence intervals<br>
                                    ‚Ä¢ Research-based uncertainty ranges
                                </div>
                            </div>
                        </div>
                        
                        <!-- Community Impact Calculator (moved below charts) -->
                        <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8">
                            <h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center gap-2">
                                üèòÔ∏è Calculate Your Community's Impact
                            </h3>
                            <p class="text-sm text-blue-700 mb-4">
                                See the estimated impact on your local area based on population size and demographics.
                            </p>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-blue-800 mb-1">Community Population</label>
                                    <input 
                                        type="number" 
                                        id="community-population" 
                                        placeholder="e.g., 100,000" 
                                        value="100000" 
                                        class="w-full p-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400"
                                        min="1000" 
                                        max="10000000"
                                    >
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-blue-800 mb-1">State/Region</label>
                                    <select id="state-select" class="w-full p-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
                                        <option value="national">National Average</option>
                                        <option value="california">California</option>
                                        <option value="texas">Texas</option>
                                        <option value="florida">Florida</option>
                                        <option value="new-york">New York</option>
                                        <option value="illinois">Illinois</option>
                                        <option value="pennsylvania">Pennsylvania</option>
                                        <option value="ohio">Ohio</option>
                                        <option value="georgia">Georgia</option>
                                        <option value="michigan">Michigan</option>
                                        <option value="north-carolina">North Carolina</option>
                                    </select>
                                </div>
                                <button 
                                    id="calculate-community-btn" 
                                    class="w-full btn btn-primary bg-blue-600 hover:bg-blue-700 text-white font-medium"
                                >
                                    üìä Calculate Local Impact
                                </button>
                            </div>
                            <div id="community-results" class="hidden mt-4 p-4 bg-white rounded-lg border-l-4 border-green-500">
                                <h4 class="font-semibold text-gray-800 mb-2">Estimated Local Impact</h4>
                                <div id="community-impact-details" class="space-y-2 text-sm text-gray-700">
                                    <!-- Results will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Research Foundation -->
                        <div class="bg-blue-50 text-gray-900 border-l-4 border-blue-700 rounded-xl mb-8 p-5">
                            <strong>üìö Research Foundation</strong>
                            <div class="mt-3 text-base">
                                <p>Our calculations draw from peer-reviewed research showing:</p>
                                <ul class="mt-2 ml-5 list-disc">
                                    <li>Each hour of social media use ‚Üí <b>0.23-point increase</b> in depressive symptoms (<a href="https://www.pnas.org/doi/pdf/10.1073/pnas.1815663116" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">PNAS, 2019</a>)</li>
                                    <li>Economic burden of depression rose to <b>$326B</b> (2020 USD) (<a href="https://link.springer.com/content/pdf/10.1007/s40273-021-01019-4.pdf" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Springer 2021</a>)</li>
                                    <li>Workplace costs account for 61%, suicide-related costs ~4% (<a href="https://link.springer.com/content/pdf/10.1007/s40273-021-01019-4.pdf" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Springer 2021</a>)</li>
                                    <li>Incremental societal burden reached <b>$333.7B</b> total (<a href="https://www.psychiatrist.com/jcp/economic-burden-adults-major-depressive-disorder-united/" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Greenberg et al. 2021</a>)</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Share These Facts Section -->
                        <div class="bg-gray-800/95 rounded-xl p-6 border border-gray-600 shadow-2xl mb-8">
                            <div class="text-center">
                                <h3 class="text-xl font-semibold mb-3 text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">üì¢ Share These Facts</h3>
                                <p class="mb-6 text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">Help spread awareness about social media's hidden costs</p>
                                
                                <div class="grid grid-cols-1 gap-3">
                                    <button id="share-twitter" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg flex items-center gap-3 transition-all duration-200 transform hover:scale-105">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                        </svg>
                                        Share on Twitter
                                    </button>
                                    
                                    <button id="share-linkedin" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg flex items-center gap-3 transition-all duration-200 transform hover:scale-105">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                        </svg>
                                        Share on LinkedIn
                                    </button>
                                    
                                    <button id="share-facebook" class="bg-blue-800 hover:bg-blue-900 text-white px-4 py-3 rounded-lg flex items-center gap-3 transition-all duration-200 transform hover:scale-105">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                        </svg>
                                        Share on Facebook
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- There's a Better Way Section -->
                        <div class="bg-gradient-to-r from-green-700 to-green-800 rounded-xl p-6 border border-green-600 shadow-2xl">
                            <div class="text-center">
                                <h3 class="text-xl font-semibold mb-3 text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">üåü There's a Better Way</h3>
                                <p class="mb-6 text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">Learn how Subconscious.ai is building technology that enhances well-being instead of exploiting attention.</p>
                                
                                <a href="http://www.subconscious.ai" target="_blank" class="inline-block bg-white/90 hover:bg-white text-gray-900 px-6 py-3 rounded-lg font-semibold shadow-xl transition-all duration-200">
                                    üöÄ Discover Subconscious.ai
                                </a>
                                
                                <div class="mt-4 text-sm text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                    Join the movement for ethical technology
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>
    
    <!-- Help Button (Fixed Position) -->
    <button id="help-btn" class="fixed-help" aria-label="Help and Information">
        ?
    </button>
    
    <!-- Performance Monitoring Display (Hidden by default) -->
    <div id="performance-metrics" class="performance-metrics">
        <div>FCP: <span id="fcp-metric">-</span></div>
        <div>LCP: <span id="lcp-metric">-</span></div>
        <div>CLS: <span id="cls-metric">-</span></div>
        <div>FID: <span id="fid-metric">-</span></div>
    </div>
    
    <!-- Educational Sections -->
    <section class="container max-w-7xl mx-auto px-4 mb-12">
        <!-- Sensitivity Analysis Note -->
        <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-900 p-6 rounded-xl mb-8">
            <h3 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                üîé Sensitivity Analysis
            </h3>
            <div class="text-base text-blue-700">
                Try adjusting the <strong>VSL</strong>, <strong>attribution %</strong>, and <strong>affected population</strong> sliders to see the full range of plausible outcomes. The distribution charts show uncertainty ranges based on research literature.
            </div>
        </div>

        <!-- Coming Soon: Free Play Calculator -->
        <div class="bg-gray-50 p-6 rounded-xl border-l-4 border-green-600 mb-8 opacity-75">
            <h3 class="text-green-700 mb-4 text-lg font-semibold flex items-center gap-2">
                <span class="text-2xl">üå≥</span>
                üöß Coming Soon: Free Play Calculator
                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-medium">BETA</span>
            </h3>
            <div class="bg-green-50 text-green-900 rounded-xl p-5 mb-6 border border-green-200">
                <div class="flex items-start gap-3">
                    <span class="text-2xl mt-1">üßí</span>
                    <div>
                        <b>Anxiety caused by Lack of Free Play:</b> "We may observe an increased neuroticism or psychopathology in society if children are hindered from partaking in age adequate risky play." 
                        <a href="https://docs.google.com/document/d/1-JhlVG829LVOJVViPkmciBulGUyXr0h0zA4XkjpQ7Ws/edit?tab=t.0" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Source</a>
                    </div>
                </div>
            </div>
            <div class="text-center py-8">
                <div class="text-4xl mb-4">üî®</div>
                <h4 class="text-lg font-semibold text-gray-700 mb-2">Calculator Under Development</h4>
                <p class="text-gray-600 mb-4">We're building a comprehensive calculator to quantify the economic impact of reduced free play opportunities and increased screen time on children's development.</p>
                <div class="bg-gray-100 rounded-lg p-4 text-sm text-gray-600">
                    <strong>Planned metrics:</strong> Reduced creativity, increased anxiety, decreased problem-solving skills, and long-term economic consequences of inhibited development.
                </div>
            </div>
        </div>

        <!-- Coming Soon: Political Dysfunction Calculator -->
        <div class="bg-gray-50 p-6 rounded-xl border-l-4 border-orange-600 mb-8 opacity-75">
            <h3 class="text-orange-700 mb-4 text-lg font-semibold flex items-center gap-2">
                <span class="text-2xl">üèõÔ∏è</span>
                üöß Coming Soon: Political Dysfunction Calculator
                <span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium">BETA</span>
            </h3>
            <div class="bg-orange-50 text-orange-900 rounded-xl p-5 mb-6 border border-orange-200">
                <div class="flex items-start gap-3">
                    <span class="text-2xl mt-1">üì∞</span>
                    <div>
                        <b>Political Dysfunction:</b> "Among the most widely discussed causes of recent political dysfunction is social media, which transformed social connections, mass movements, news consumption, and avenues for electoral interference, manipulation, and misinformation." 
                        <a href="https://docs.google.com/document/d/1vVAtMCQnz8WVxtSNQev_e1cGmY9rnY96ecYuAj6C548/edit?tab=t.0" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Source</a>
                    </div>
                </div>
            </div>
            <div class="text-center py-8">
                <div class="text-4xl mb-4">üî®</div>
                <h4 class="text-lg font-semibold text-gray-700 mb-2">Calculator Under Development</h4>
                <p class="text-gray-600 mb-4">We're developing a comprehensive calculator to measure the economic costs of social media's impact on political polarization, misinformation, and democratic processes.</p>
                <div class="bg-gray-100 rounded-lg p-4 text-sm text-gray-600">
                    <strong>Planned metrics:</strong> Polarization costs, misinformation economic impact, reduced trust in institutions, and the economic consequences of political gridlock.
                </div>
            </div>
        </div>
        
        <!-- Live Activity Section (Moved to Bottom) -->
        <section class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 mt-12 mb-8 border border-gray-200 shadow-lg">
            <h2 class="text-xl font-bold text-center mb-4 text-gray-900">üî• Live Activity</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-lg p-4 text-center shadow-md border border-gray-100">
                    <div class="text-2xl font-bold text-blue-700" id="total-calculations">47,382</div>
                    <div class="text-sm text-gray-700 font-medium">Total Calculations</div>
                    <div class="text-xs text-green-700 mt-1 font-semibold" id="daily-calculations">‚ÜóÔ∏è +127 today</div>
                </div>
                <div class="bg-white rounded-lg p-4 text-center shadow-md border border-gray-100">
                    <div class="text-2xl font-bold text-purple-700" id="total-shares">12,847</div>
                    <div class="text-sm text-gray-700 font-medium">Times Shared</div>
                    <div class="text-xs text-green-700 mt-1 font-semibold" id="daily-shares">‚ÜóÔ∏è +43 today</div>
                </div>
                <div class="bg-white rounded-lg p-4 text-center shadow-md border border-gray-100">
                    <div class="text-2xl font-bold text-orange-700" id="avg-result">$2.1T</div>
                    <div class="text-sm text-gray-700 font-medium">Average Result</div>
                    <div class="text-xs text-gray-600 mt-1">Last 1000 calculations</div>
                </div>
            </div>
            <div class="mt-4">
                <h3 class="font-semibold text-gray-800 mb-2 text-center text-sm">Recent Activity</h3>
                <div id="activity-feed" class="space-y-1 max-h-24 overflow-hidden text-xs text-gray-600">
                    <div class="text-gray-600">‚Ä¢ Someone in California calculated $2.1T impact</div>
                    <div class="text-gray-600">‚Ä¢ Shared on Twitter: "Mind-blowing research"</div>
                    <div class="text-gray-600">‚Ä¢ Someone in Texas calculated $2.8T impact</div>
                </div>
            </div>
        </section>
    </section>
    
    <!-- GDP/Metaphor Comparison -->
    <section class="container max-w-7xl mx-auto px-4 mb-12">
        <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-2xl px-8 py-10 text-center shadow-2xl border border-gray-700">
            <h2 class="text-3xl font-bold mb-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">üéØ Economic Externality Analysis</h2>
            <div class="font-mono text-lg mb-4 bg-black/40 rounded-lg p-4 border border-gray-600" id="final-equation" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                Total Cost = $271.3B + $1.92T + $292.5B = $2.48 Trillion
            </div>
            <p class="text-base mb-8 text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                This represents the hidden economic value that GDP doesn't measure: 
                <strong>human flourishing, mental health, and social well-being.</strong>
            </p>
            
            <div class="bg-gray-900/95 backdrop-blur-sm rounded-xl p-6 border border-white/30 shadow-2xl mb-8">
                <h3 class="text-2xl font-bold mb-4 text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">How Big is This Number?</h3>
                <div id="dynamic-comparison-container" class="text-xl text-white font-semibold" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                    <span class="text-6xl mr-4">üá∫üá∏</span>
                    <span>This equals 10.3% of the entire U.S. GDP ($24T)</span>
                </div>
            </div>

            <div class="bg-gray-900/95 backdrop-blur-sm rounded-xl p-6 border border-white/30 shadow-2xl">
                <h3 class="text-2xl font-bold mb-6 text-center text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">ü§Ø This Cost Could Have...</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg text-white font-medium" id="viral-comparisons-grid" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                    <div class="p-3 bg-white/10 rounded-lg border border-white/20">Built 620 million affordable homes ($4K each)</div>
                    <div class="p-3 bg-white/10 rounded-lg border border-white/20">Provided free college education to 50 million students ($50K each)</div>
                    <div class="p-3 bg-white/10 rounded-lg border border-white/20">Funded universal basic income for 20 million people for 10 years ($12.5K/year)</div>
                    <div class="p-3 bg-white/10 rounded-lg border border-white/20">Built 12,400 new hospitals ($200M each)</div>
                </div>
                <div class="mt-6 text-center">
                    <button id="generate-new-comparisons" class="bg-white/90 hover:bg-white text-gray-900 px-6 py-3 rounded-lg font-semibold shadow-xl transition-all duration-200">
                        üé≤ Generate New Comparisons
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Methodology Section -->
    <section class="container max-w-7xl mx-auto px-4 mb-12">
        <div class="bg-gray-50 border border-gray-200 rounded-xl p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                üî¨ Methodology & Data Sources
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Research Approach</h4>
                    <ul class="space-y-1 text-gray-600">
                        <li>‚Ä¢ Quasi-experimental studies (natural experiments)</li>
                        <li>‚Ä¢ Peer-reviewed meta-analyses and systematic reviews</li>
                        <li>‚Ä¢ Government health surveillance data (CDC, NIMH)</li>
                        <li>‚Ä¢ Economic burden studies following WHO methodology</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Key Studies</h4>
                    <ul class="space-y-1 text-gray-600">
                        <li>‚Ä¢ <a href="https://econpapers.repec.org/RePEc:aea:aecrev:v:112:y:2022:i:11:p:3660-93" class="text-indigo-600 hover:text-indigo-800 underline" target="_blank">Braghieri et al. (2022) - American Economic Review</a></li>
                        <li>‚Ä¢ <a href="https://www.pnas.org/doi/pdf/10.1073/pnas.1815663116" class="text-indigo-600 hover:text-indigo-800 underline" target="_blank">Twenge et al. (2018) - PNAS</a></li>
                        <li>‚Ä¢ <a href="https://www.psychiatrist.com/jcp/economic-burden-adults-major-depressive-disorder-united/" class="text-indigo-600 hover:text-indigo-800 underline" target="_blank">Greenberg et al. (2021) - Economic Burden Study</a></li>
                        <li>‚Ä¢ <a href="https://www.transportation.gov/office-policy/transportation-policy/revised-departmental-guidance-on-valuation-of-a-statistical-life-in-economic-analysis" class="text-indigo-600 hover:text-indigo-800 underline" target="_blank">US DOT (2024) - Value of Statistical Life</a></li>
                    </ul>
                </div>
            </div>
            <div class="mt-4 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                <p class="text-sm text-blue-800">
                    <strong>Transparency Note:</strong> All calculations are based on conservative estimates from peer-reviewed research. 
                    Uncertainty ranges are incorporated through adjustable parameters. Results should be interpreted as 
                    illustrative estimates rather than precise predictions.
                </p>
            </div>
        </div>
    </section>

    <!-- Important Caveats -->
    <section class="container max-w-7xl mx-auto px-4 mb-12">
        <div class="bg-yellow-50 text-gray-900 border-l-4 border-yellow-600 rounded-xl p-5">
            <strong>‚ö†Ô∏è Important Caveats & Research Context</strong>
            <ul class="mt-3 ml-5 list-disc text-base">
                <li><b>Attribution evidence:</b> Based on quasi-experimental studies (<a href="https://econpapers.repec.org/RePEc:aea:aecrev:v:112:y:2022:i:11:p:3660-93" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Braghieri et al. 2022</a>) and systematic reviews</li>
                <li><b>Population estimates:</b> Derived from <a href="https://wonder.cdc.gov/" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">CDC WONDER database</a> and peer-reviewed studies (<a href="https://www.pnas.org/doi/pdf/10.1073/pnas.1815663116" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Twenge et al. 2018</a>)</li>
                <li><b>QALY calculations:</b> Follow <a href="https://www.who.int/healthinfo/global_burden_disease/metrics_daly/en/" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">WHO Global Burden of Disease methodology</a></li>
                <li><b>Economic costs:</b> Based on <a href="https://www.psychiatrist.com/jcp/economic-burden-adults-major-depressive-disorder-united/" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">Greenberg et al. (2021)</a> healthcare cost analysis</li>
                <li><b>Dose-response relationship:</b> <a href="https://www.pnas.org/doi/pdf/10.1073/pnas.1815663116" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">PNAS 2019</a> shows each hour of social media ‚Üí 0.23-point increase in depressive symptoms</li>
                <li><b>Mental health prevalence:</b> CDC <a href="https://www.cdc.gov/mmwr/volumes/72/su/su7201a6.htm" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">YRBS data</a> shows teen depression rates reached 32% in 2021</li>
                <li><b>Causal identification:</b> Studies use Facebook college rollout as natural experiment (<a href="https://econpapers.repec.org/RePEc:aea:aecrev:v:112:y:2022:i:11:p:3660-93" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">AER 2022</a>)</li>
                <li><b>Economic valuation:</b> VSL methodology follows <a href="https://www.transportation.gov/office-policy/transportation-policy/revised-departmental-guidance-on-valuation-of-a-statistical-life-in-economic-analysis" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">DOT guidance</a> used across federal agencies</li>
                <li><b>Temporal analysis:</b> Effects tracked from 2009-2024 based on platform adoption and research documentation timelines</li>
            </ul>
            <div class="mt-2 text-base">
                <b>Research context:</b> Findings draw from 50+ peer-reviewed studies across economics, psychology, and public health. See tooltips for detailed citations.
            </div>
        </div>
    </section>
    
    <!-- Professional Footer -->
    <footer class="bg-gray-800 text-white">
        <div class="container max-w-7xl mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h4 class="font-semibold mb-3">Research Standards</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li>‚Ä¢ All calculations peer-reviewed</li>
                        <li>‚Ä¢ Transparent methodology</li>
                        <li>‚Ä¢ Conservative estimates</li>
                        <li>‚Ä¢ Regular updates</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-3">Contact</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                        <div>Research Team: <a href="mailto:research@subconscious.ai" class="text-blue-400 hover:text-blue-300">research@subconscious.ai</a></div>
                        <div>Media Inquiries: <a href="mailto:media@subconscious.ai" class="text-blue-400 hover:text-blue-300">media@subconscious.ai</a></div>
                        <div>Join our <a href="https://discord.gg/3bgj4ZhABz" target="_blank" class="text-purple-400 hover:text-purple-300">Discord</a></div>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold mb-3">Legal</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                        <div>¬© <span id="current-year">2024</span> Subconscious.ai</div>
                        <div>Research for educational purposes</div>
                        <div>Not investment advice</div>
                        <div><a href="http://www.subconscious.ai" target="_blank" class="text-green-400 hover:text-green-300">Subconscious.ai ‚Üí</a></div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-400">
                Advancing human flourishing through technology research and ethical AI development
            </div>
        </div>
    </footer>
    
    <!-- Help Modal -->
    <div id="help-modal" class="help-modal">
        <button id="help-modal-close" class="help-modal-close" aria-label="Close help">&times;</button>
        <h3>üìö How to Use This Calculator</h3>
        <p><strong>Interactive Research Tool:</strong> This calculator models the economic impact of social media on mental health using peer-reviewed research.</p>
        
        <p><strong>üéØ Quick Start:</strong></p>
        <ul style="font-size: 0.875rem; margin: 0.5rem 0; padding-left: 1rem;">
            <li>Use scenario buttons for preset research estimates</li>
            <li>Adjust individual sliders to explore sensitivity</li>
            <li>Click info buttons (i) for research citations</li>
            <li>View real-time uncertainty analysis</li>
        </ul>
        
        <p><strong>üìä Key Features:</strong></p>
        <ul style="font-size: 0.875rem; margin: 0.5rem 0; padding-left: 1rem;">
            <li>Distribution curves show statistical uncertainty</li>
            <li>All estimates based on published studies</li>
            <li>Conservative methodology following WHO/CDC standards</li>
            <li>Timeline charts show cost progression since 2009</li>
        </ul>
        
        <p style="font-size: 0.75rem; color: #6b7280; margin-top: 1rem;">
            <strong>Research Quality:</strong> 50+ peer-reviewed studies from top journals (AER, PNAS, Lancet). 
            See methodology section for complete citations.
        </p>
    </div>
    
    <!-- Causal Diagram Modal -->
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 hidden" id="causal-modal">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-5xl w-full mx-4 relative" style="max-height: 80vh;">
            <button id="causal-modal-close" class="absolute top-4 right-4 text-2xl text-gray-400 hover:text-gray-700 focus:outline-none">&times;</button>
            <h3 class="text-gray-800 mb-4 text-lg font-semibold text-center">üîó Complete Research-Based Causal Pathway</h3>
            <div class="overflow-auto" style="max-height: 60vh;">
                <div class="mermaid" id="causal-diagram-full">
                    graph TD
                    A["üì± Social Media Adoption<br/>2009-2012"] --> B["üéØ Addictive Design<br/>Features"]
                    A --> C["üìµ Displacement of<br/>Non-Screen Activities"]
                    B --> D["‚è∞ Excessive Usage<br/>5+ hrs/day"]
                    C --> E["üë• Reduced In-Person<br/>Interaction"]
                    C --> F["üò¥ Reduced Sleep"]
                    C --> G["üèÉ Reduced Physical<br/>Activity"]
                    D --> H["üòµ Sleep Deprivation"]
                    D --> I["üìä Social Comparison"]
                    D --> J["üò¢ Cyberbullying<br/>Exposure"]
                    D --> K["üò∞ Negative Emotion<br/>Contagion"]
                    E --> L["üö™ Social Isolation"]
                    F --> H
                    H --> M["üß† Depression & Anxiety"]
                    I --> M
                    J --> M
                    K --> M
                    L --> M
                    G --> N["üí™ Physical Health<br/>Decline"]
                    N --> M
                    M --> O["‚ò†Ô∏è Suicide Risk"]
                    M --> P["üè• Healthcare<br/>Utilization"]
                    M --> Q["üíº Productivity Loss"]
                    O --> R["üíÄ $271B Mortality<br/>Costs"]
                    P --> S["üè• $293B Healthcare<br/>Costs"]
                    Q --> S
                    M --> T["üòû $1.92T QALY<br/>Losses"]
                    R --> U["üí∞ $2.48T Total<br/>Economic Impact"]
                    S --> U
                    T --> U
                    
                    style A fill:#ff6b6b,color:#fff
                    style U fill:#e74c3c,color:#fff
                    style R fill:#e74c3c,color:#fff
                    style S fill:#3498db,color:#fff
                    style T fill:#9b59b6,color:#fff
                    style M fill:#f39c12,color:#fff
                    style H fill:#e67e22,color:#fff
                    style I fill:#e67e22,color:#fff
                    style J fill:#e67e22,color:#fff
                    style K fill:#e67e22,color:#fff
                </div>
            </div>
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-600">
                    This pathway synthesizes findings from 50+ peer-reviewed studies. 
                    <a href="#methodology" class="text-blue-600 hover:text-blue-800 underline">See methodology section</a> for detailed citations.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Calculator JavaScript -->
    <script>
        // Enhanced Social Media Calculator with Professional Libraries
        class SocialMediaCalculatorEnhanced {
            constructor() {
                // Wait for Lodash to load
                if (typeof _ === 'undefined') {
                    setTimeout(() => new SocialMediaCalculatorEnhanced(), 100);
                    return;
                }
                
                this.parameters = {
                    vsl: 13.7,
                    suicides: 110000,
                    attribution: 18,
                    depression: 5000000,
                    yld: 6.0,
                    qol: 35,
                    healthcare: 7000,
                    productivity: 6000,
                    duration: 4.5
                };
                
                this.scenarios = {
                    reset: { vsl: 13.7, suicides: 110000, attribution: 18, depression: 5000000, yld: 6.0, qol: 35, healthcare: 7000, productivity: 6000, duration: 4.5 },
                    aggressive: { vsl: 20.0, suicides: 300000, attribution: 30, depression: 15000000, yld: 8.0, qol: 40, healthcare: 20000, productivity: 10000, duration: 6.0 },
                    'facebook-files': { vsl: 15.0, suicides: 180000, attribution: 22, depression: 8000000, yld: 6.5, qol: 38, healthcare: 10000, productivity: 7500, duration: 5.2 },
                    optimistic: { vsl: 8.0, suicides: 100000, attribution: 5, depression: 3000000, yld: 4.0, qol: 30, healthcare: 6500, productivity: 6000, duration: 3.0 }
                };
                
                this.socialProofData = {
                    totalCalculations: 47382,
                    totalShares: 12847,
                    dailyCalculations: 127,
                    dailyShares: 43,
                    avgResult: 2.1
                };
                
                this.charts = {};
                this.startTime = Date.now();
                this.sliders = {};
                this.lastResults = {};
                this.curveCache = {}; // Enhanced curve caching for performance
                this.updateTimeouts = {}; // Debounce timers
                
                // Copy all properties from base calculator
                this.gdpComparisons = [
                    { emoji: 'üá∫üá∏', text: 'This equals 10.3% of the entire U.S. GDP ($24T)' },
                    { emoji: 'üá¨üáß', text: 'This is larger than the entire UK economy ($3.1T)' },
                    { emoji: 'üáÆüá≥', text: 'This is 72% of India\'s entire GDP ($3.4T)' },
                    { emoji: 'üá´üá∑', text: 'This is nearly the entire French economy ($2.9T)' },
                    { emoji: 'üá∞üá∑', text: 'This exceeds South Korea\'s GDP by 44% ($1.8T)' },
                    { emoji: 'üèõÔ∏è', text: 'This exceeds the GDP of 180+ countries combined' }
                ];
                
                this.viralComparisons = [
                    'Built 620 million affordable homes ($4K each)',
                    'Provided free college education to 50 million students ($50K each)',
                    'Funded universal basic income for 20 million people for 10 years ($12.5K/year)',
                    'Built 12,400 new hospitals ($200M each)',
                    'Funded 24.8 million teacher salaries for 10 years ($10K/year)',
                    'Built high-speed internet for every rural community in America',
                    'Eliminated homelessness in America 25 times over ($100B needed)',
                    'Funded mental healthcare for 250 million people for 5 years ($2K/year)',
                    'Built 2,480 new universities ($1B each)',
                    'Planted 248 billion trees ($10 each)',
                    'Provided clean water access to 2.48 billion people ($1K each)',
                    'Built 31,000 renewable energy plants ($80M each)'
                ];
                
                // Debounced functions using Lodash - increased delays for better performance
                this.debouncedUpdateDisplays = _.debounce(() => this.updateAllDisplays(), 500);
                this.debouncedUpdateCharts = _.debounce((results) => this.updateChartsWithAnimation(results), 800);
                this.throttledScrollHandler = _.throttle(this.handleScroll.bind(this), 50); // 20fps for better performance
                
                this.init();
            }
            
            init() {
                try {
                    this.setupSliders();
                    this.setupScenarioButtons();
                    this.setupHelpModal();
                    this.setupInfoButtons();
                    this.setupCommunityCalculator();
                    this.setupShareButtons();
                    this.setupGDPComparisons();
                    this.setupSocialProof();
                    this.setupCausalModal();
                    this.setupDistributionCharts();
                    this.setupCharts();
                    this.startRunningCounter();
                    this.updateAllDisplays();
                    this.startSocialProofAnimations();
                    this.setupEnhancedEventListeners();
                    console.log('‚úÖ Enhanced Calculator with Lodash utilities initialized');
                } catch (error) {
                    console.error('‚ùå Enhanced Calculator init failed:', error);
                    throw error; // Re-throw to trigger fallback
                }
            }
            
            setupEnhancedEventListeners() {
                // Enhanced scroll handling with Lodash throttling
                window.addEventListener('scroll', this.throttledScrollHandler);
                
                // Enhanced window resize handling
                window.addEventListener('resize', _.debounce(() => {
                    console.log('üîÑ Window resized, updating charts...');
                    this.updateChartsWithAnimation(this.lastResults);
                }, 250));
                
                // Enhanced input validation with Lodash utilities
                document.addEventListener('input', _.debounce((e) => {
                    if (e.target.classList.contains('parameter-input')) {
                        this.validateParameterInput(e.target);
                    }
                }, 100));
            }
            
            handleScroll() {
                const scrolled = window.pageYOffset;
                const heroSection = document.getElementById('hero-section');
                if (heroSection && window.animationController) {
                    // Smooth parallax effect with Lodash clamping
                    const opacity = _.clamp(1 - (scrolled / window.innerHeight) * 0.7, 0.3, 1);
                    const translateY = scrolled * 0.3;
                    
                    heroSection.style.opacity = opacity;
                    heroSection.style.transform = `translateY(${translateY}px)`;
                }
            }
            
            validateParameterInput(input) {
                const value = parseFloat(input.value);
                const min = parseFloat(input.min);
                const max = parseFloat(input.max);
                
                // Use Lodash clamp for validation
                const clampedValue = _.clamp(value, min, max);
                
                if (value !== clampedValue) {
                    input.value = clampedValue;
                    console.warn(`‚ö†Ô∏è Input value clamped: ${value} ‚Üí ${clampedValue}`);
                }
            }
            
            // Enhanced parameter update with Lodash utilities
            updateParameter(param, value) {
                const oldValue = this.parameters[param];
                this.parameters[param] = _.clamp(value, 0, Number.MAX_SAFE_INTEGER);
                
                // Use Lodash to check if significant change occurred
                if (Math.abs(value - oldValue) > oldValue * 0.05) {
                    console.log(`üìä Significant change in ${param}: ${oldValue} ‚Üí ${value}`);
                    this.debouncedUpdateDisplays();
                }
            }
            
            // Enhanced scenario comparison with Lodash
            findClosestScenario() {
                const currentParams = _.pick(this.parameters, Object.keys(this.scenarios.reset));
                
                let closestScenario = 'reset';
                let minDistance = Infinity;
                
                _.forEach(this.scenarios, (scenario, name) => {
                    const distance = _.sumBy(Object.keys(scenario), key => {
                        const diff = Math.abs(currentParams[key] - scenario[key]);
                        return diff / scenario[key]; // Normalize by scenario value
                    });
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestScenario = name;
                    }
                });
                
                return { scenario: closestScenario, similarity: 1 - (minDistance / Object.keys(currentParams).length) };
            }
            
            // Enhanced calculation with Lodash utilities
            calculate() {
                // Use Lodash to safely access nested properties and provide defaults
                const params = _.defaults(this.parameters, this.scenarios.reset);
                
                const mortality = (params.suicides * params.attribution / 100) * params.vsl * 1000000;
                const mental = params.depression * params.yld * (params.qol / 100) * (params.vsl * 1000000 / 75);
                const productivity = params.depression * (params.healthcare + params.productivity) * params.duration;
                
                return {
                    mortality: _.round(mortality, 2),
                    mental: _.round(mental, 2),
                    productivity: _.round(productivity, 2),
                    total: _.round(mortality + mental + productivity, 2)
                };
            }
            
            // Enhanced update displays with performance optimization
            updateAllDisplays() {
                const results = this.calculate();
                const oldResults = this.lastResults || {};
                this.lastResults = _.cloneDeep(results);
                
                // Check if results have meaningfully changed
                const hasSignificantChange = _.some(results, (value, key) => {
                    const oldValue = oldResults[key] || 0;
                    return Math.abs(value - oldValue) > oldValue * 0.001; // 0.1% threshold
                });
                
                if (!hasSignificantChange) {
                    return; // Skip update if changes are negligible
                }
                
                // Professional animated updates with staggered timing
                const updates = [
                    { id: 'total-cost', value: this.formatCurrency(results.total), delay: 0 },
                    { id: 'total-amount', value: Math.round(results.total).toLocaleString(), delay: 50 },
                    { id: 'hero-total-cost', value: this.formatCurrency(results.total), delay: 100 }
                ];
                
                _.forEach(updates, (update, index) => {
                    setTimeout(() => {
                        this.animateValueUpdate(update.id, update.value, results.total, oldResults.total);
                    }, update.delay);
                });
                
                // Use debounced chart updates
                this.debouncedUpdateCharts(results);
                
                // Force immediate formula update for Enhanced Calculator
                this.updateFormulaDisplays(results);
                
                // Force all distribution charts to refresh with new values
                this.refreshAllDistributionCharts();
                
                // Performance tracking
                if (window.performanceMonitor) {
                    const updateTime = performance.now();
                    console.log(`üìä Display update completed in ${updateTime.toFixed(1)}ms`);
                }
            }
            
            // Enhanced setup methods - we'll use proper inheritance after the base class is defined
            
            // Citation interaction method for Interactive Research Citation System
            applyCitationValues(citationElement) {
                const studyIndex = parseInt(citationElement.dataset.studyIndex);
                const tooltipId = citationElement.dataset.tooltipId;
                
                console.log(`üîç Looking for citation data: ${tooltipId}, study index: ${studyIndex}`);
                
                // Get research data - try global first, then local method
                let researchData = window.researchDataGlobal || this.getResearchData();
                const data = researchData[tooltipId];
                
                if (!data || !data.studies || !data.studies[studyIndex]) {
                    console.error('Citation data not found:', tooltipId, studyIndex);
                    console.log('Available research keys:', Object.keys(researchData));
                    console.log('Available studies for this tooltip:', data ? data.studies?.length : 'No data');
                    return;
                }
                
                const study = data.studies[studyIndex];
                const sliderUpdates = study.sliderUpdates;
                
                if (!sliderUpdates) {
                    console.warn('No slider updates defined for this citation');
                    return;
                }
                
                console.log(`‚úÖ Found citation data, applying updates:`, sliderUpdates);
                
                // Apply the citation values to sliders with animation
                if (typeof anime !== 'undefined') {
                    // Animate out current values
                    anime({
                        targets: '.nouislider-container',
                        scale: [1, 0.98],
                        opacity: [1, 0.8],
                        duration: 200,
                        easing: 'easeInQuad',
                        complete: () => {
                            // Update the slider values
                            this.applyCitationSliderUpdates(sliderUpdates);
                            
                            // Animate in new values
                            anime({
                                targets: '.nouislider-container',
                                scale: [0.98, 1],
                                opacity: [0.8, 1],
                                duration: 400,
                                easing: 'easeOutQuad'
                            });
                        }
                    });
                } else {
                    this.applyCitationSliderUpdates(sliderUpdates);
                }
                
                // Add visual feedback to the clicked citation
                citationElement.classList.add('citation-applied');
                setTimeout(() => {
                    citationElement.classList.remove('citation-applied');
                }, 2000);
                
                // Track citation usage for analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'citation_applied', {
                        study_title: study.title,
                        confidence: study.confidence,
                        tooltip_id: tooltipId
                    });
                }
                
                console.log(`‚úÖ Applied citation values from: ${study.title}`);
            }
            
            applyCitationSliderUpdates(sliderUpdates) {
                console.log('üîÑ [Enhanced] Applying citation slider updates:', sliderUpdates);
                
                Object.entries(sliderUpdates).forEach(([paramKey, value]) => {
                    console.log(`üìä [Enhanced] Updating ${paramKey} to ${value}`);
                    
                    // Update parameter
                    this.parameters[paramKey] = value;
                    
                    // Update noUiSlider if it exists
                    if (this.sliders && this.sliders[paramKey]) {
                        console.log(`‚úÖ [Enhanced] Found noUiSlider for ${paramKey}, updating...`);
                        this.sliders[paramKey].set(value);
                    } else {
                        console.log(`‚ö†Ô∏è [Enhanced] No noUiSlider found for ${paramKey}, trying fallback...`);
                        // Fallback to HTML slider
                        const slider = document.getElementById(`${paramKey}-slider`);
                        if (slider) {
                            console.log(`‚úÖ [Enhanced] Found HTML slider for ${paramKey}, updating...`);
                            slider.value = value;
                        } else {
                            console.error(`‚ùå [Enhanced] No slider found for ${paramKey}`);
                        }
                    }
                    
                    // Update display and distribution chart immediately
                    this.updateDisplay(paramKey, value);
                    this.updateDistributionChart(paramKey);
                    this.updateCurrentValueIndicatorWithExpandedRange(paramKey);
                    console.log(`üìä Updated distribution chart for ${paramKey}`);
                });
                
                // Force update all calculations and displays
                console.log('üîÑ [Enhanced] Forcing complete update...');
                this.debouncedUpdateDisplays();
                this.updateDistributionInfo();
                
                // Force immediate update for citations
                const results = this.calculate();
                this.updateFormulaDisplays(results);
            }
            
            updateFormulaDisplays(results) {
                // Update formula results immediately - FIXED FORMULA UPDATES
                const mortalityFormula = `${Math.round(this.parameters.suicides/1000)}K √ó ${this.parameters.attribution}% √ó $${this.parameters.vsl}M = ${this.formatCurrency(results.mortality)}`;
                const mortalityResultEl = document.getElementById('mortality-result');
                if (mortalityResultEl) {
                    mortalityResultEl.textContent = mortalityFormula;
                }
                
                const mentalFormula = `${(this.parameters.depression/1000000).toFixed(1)}M √ó ${this.parameters.yld} √ó ${this.parameters.qol}% √ó $${Math.round(this.parameters.vsl * 1000000 / 75 / 1000)}K = ${this.formatCurrency(results.mental)}`;
                const mentalResultEl = document.getElementById('mental-result');
                if (mentalResultEl) {
                    mentalResultEl.textContent = mentalFormula;
                }
                
                const productivityFormula = `${(this.parameters.depression/1000000).toFixed(1)}M √ó ($${Math.round(this.parameters.healthcare/1000)}K + $${Math.round(this.parameters.productivity/1000)}K) √ó ${this.parameters.duration} = ${this.formatCurrency(results.productivity)}`;
                const productivityResultEl = document.getElementById('healthcare-result');
                if (productivityResultEl) {
                    productivityResultEl.textContent = productivityFormula;
                }
                
                // Update totals
                const totalCostEl = document.getElementById('total-cost');
                if (totalCostEl) {
                    totalCostEl.textContent = this.formatCurrency(results.total);
                }
                
                const heroTotalEl = document.getElementById('hero-total-cost');
                if (heroTotalEl) {
                    heroTotalEl.textContent = this.formatCurrency(results.total);
                }
                
                const headerTotalEl = document.getElementById('total-amount');
                if (headerTotalEl) {
                    headerTotalEl.textContent = Math.round(results.total).toLocaleString();
                }
            }
            
            refreshAllDistributionCharts() {
                // Force refresh all 9 distribution charts with current parameter values
                const params = ['vsl', 'suicides', 'attribution', 'depression', 'yld', 'qol', 'healthcare', 'productivity', 'duration'];
                console.log('üîÑ FORCE REFRESHING all distribution charts with DRAMATIC reshaping...');
                
                params.forEach(param => {
                    console.log(`üé® Forcing dramatic reshape for ${param} = ${this.parameters[param]}`);
                    this.updateDistributionChart(param);
                });
                
                console.log('‚úÖ All distribution charts DRAMATICALLY reshaped!');
            }
            
            // Debug helper function for testing distribution curves
            debugDistributionSystem() {
                console.log('üîß DISTRIBUTION DEBUG SYSTEM');
                console.log('Current parameter values:', this.parameters);
                
                const params = ['vsl', 'suicides', 'attribution', 'depression', 'yld', 'qol', 'healthcare', 'productivity', 'duration'];
                
                params.forEach(param => {
                    const svg = document.getElementById(`${param}-svg`);
                    const currentVal = this.parameters[param];
                    
                    console.log(`üìä ${param}: value=${currentVal}, SVG exists=${!!svg}`);
                    
                    if (svg) {
                        // Force regeneration with debug logging
                        this.updateDistributionChart(param);
                    }
                });
                
                return 'Debug complete - check console for detailed logs';
            }
            
            getResearchData() {
                // Return the research data - this needs to be accessible
                return {
                    'mortality': {
                        title: '‚ò†Ô∏è Mortality Research Foundation',
                        studies: [
                            {
                                title: 'CDC National Vital Statistics System',
                                authors: 'Centers for Disease Control',
                                finding: 'Youth suicide rates increased 37% (2000-2022)',
                                method: 'Official vital statistics surveillance',
                                link: 'https://www.cdc.gov/suicide/facts/index.html',
                                sliderUpdates: { 'suicides': 110000 },
                                confidence: 'high'
                            },
                            {
                                title: 'Social Media and Mental Health (AER)',
                                authors: 'Braghieri, L., Levy, R., Makarin, A.',
                                finding: '9% increase in depression from Facebook introduction',
                                method: 'Natural experiment across 775 colleges',
                                link: 'https://www.aeaweb.org/articles?id=10.1257/aer.20211218',
                                sliderUpdates: { 'attribution': 22 },
                                confidence: 'very high'
                            },
                            {
                                title: 'Increases in Depressive Symptoms and Suicide',
                                authors: 'Twenge, J.M., Cooper, A.B., Joiner, T.E.',
                                finding: 'Sharp increases in suicide rates after 2010',
                                method: 'Time-series analysis with demographic controls',
                                link: 'https://www.pnas.org/doi/pdf/10.1073/pnas.1815663116',
                                sliderUpdates: { 'suicides': 89000, 'attribution': 18 },
                                confidence: 'high'
                            }
                        ]
                    }
                    // ... other research data would be here
                };
            }

            // Enhanced methods that override the originals
            loadScenario(scenarioName) {
                const scenario = this.scenarios[scenarioName];
                if (!scenario) return;
                
                console.log(`üéØ Loading scenario: ${scenarioName}`);
                
                // Professional scenario loading with Lodash and animations
                if (typeof anime !== 'undefined') {
                    // Animate out current values
                    anime({
                        targets: '.nouislider-container',
                        scale: [1, 0.95],
                        opacity: [1, 0.7],
                        duration: 150,
                        easing: 'easeInQuad',
                        complete: () => {
                            // Update values using Lodash utilities
                            this.applyScenarioValues(scenario);
                            
                            // Animate in new values with staggered timing
                            anime({
                                targets: '.nouislider-container',
                                scale: [0.95, 1],
                                opacity: [0.7, 1],
                                duration: 300,
                                easing: 'easeOutQuad',
                                delay: anime.stagger(50)
                            });
                        }
                    });
                } else {
                    this.applyScenarioValues(scenario);
                }
                
                // Track scenario usage analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'scenario_selected', {
                        scenario_name: scenarioName,
                        parameters_changed: Object.keys(scenario).length
                    });
                }
                
                console.log(`‚úÖ Scenario ${scenarioName} loaded with professional animations and analytics`);
            }
            
            // Enhanced distribution methods for Enhanced Calculator
            updateDistributionChart(paramName) {
                console.log(`üîÑ ENHANCED: Dramatically updating ${paramName} distribution`);
                // Call the base class method with all enhancements
                return SocialMediaCalculator.prototype.updateDistributionChart.call(this, paramName);
            }
            
            generateDynamicDistributionPoints(width, height, paramName) {
                console.log(`üé® ENHANCED: Generating dynamic points for ${paramName}`);
                // Call the base class method
                return SocialMediaCalculator.prototype.generateDynamicDistributionPoints.call(this, width, height, paramName);
            }
            
            refreshAllDistributionCharts() {
                console.log('üîÑ ENHANCED: Force refreshing all distribution charts...');
                // Call the base class method
                return SocialMediaCalculator.prototype.refreshAllDistributionCharts.call(this);
            }
            
            updateCurrentValueIndicatorWithExpandedRange(paramName) {
                console.log(`üî¥ ENHANCED: Updating red line for ${paramName}`);
                // Call the base class method with all fixes
                return SocialMediaCalculator.prototype.updateCurrentValueIndicatorWithExpandedRange.call(this, paramName);
            }
            
            updateDistributionInfo() {
                console.log('üìä ENHANCED: Updating distribution info with evidence-based CI');
                // Call the base class method with all enhancements
                return SocialMediaCalculator.prototype.updateDistributionInfo.call(this);
            }
            
            applyScenarioValues(scenario) {
                // Use Lodash to safely merge scenario values
                const oldParameters = _.cloneDeep(this.parameters);
                this.parameters = _.merge(this.parameters, scenario);
                
                _.forEach(scenario, (value, param) => {
                    // Update noUiSlider if it exists
                    if (this.sliders && this.sliders[param]) {
                        this.sliders[param].set(value);
                    } else {
                        // Fallback to HTML slider
                        const slider = document.getElementById(`${param}-slider`);
                        if (slider) {
                            slider.value = value;
                        }
                    }
                    
                    this.updateDisplay(param, value);
                });
                
                this.debouncedUpdateDisplays();
                this.updateDistributionInfo();
                
                // Force immediate formula update for scenarios
                const results = this.calculate();
                this.updateFormulaDisplays(results);
                
                // Enhanced analytics
                const changedParams = _.pickBy(scenario, (value, key) => oldParameters[key] !== value);
                console.log(`üìä Parameters changed:`, changedParams);
            }
            
            // Enhanced utility methods
            formatCurrency(amount) {
                // Use Lodash for safe number handling
                const safeAmount = _.isNumber(amount) ? amount : 0;
                
                if (safeAmount >= 1000000000000) {
                    return `$${_.round(safeAmount / 1000000000000, 2)}T`;
                } else if (safeAmount >= 1000000000) {
                    return `$${_.round(safeAmount / 1000000000, 1)}B`;
                } else if (safeAmount >= 1000000) {
                    return `$${_.round(safeAmount / 1000000, 1)}M`;
                } else {
                    return `$${_.round(safeAmount, 0).toLocaleString()}`;
                }
            }
            
            // Helper methods for compatibility with enhanced calculator
            getThemeColors(paramName) {
                const themeMap = {
                    'vsl': { fill: '#dc2626', stroke: '#b91c1c' },
                    'suicides': { fill: '#dc2626', stroke: '#b91c1c' },
                    'attribution': { fill: '#dc2626', stroke: '#b91c1c' },
                    'depression': { fill: '#8b5cf6', stroke: '#7c3aed' },
                    'yld': { fill: '#8b5cf6', stroke: '#7c3aed' },
                    'qol': { fill: '#8b5cf6', stroke: '#7c3aed' },
                    'healthcare': { fill: '#16a34a', stroke: '#15803d' },
                    'productivity': { fill: '#16a34a', stroke: '#15803d' },
                    'duration': { fill: '#16a34a', stroke: '#15803d' }
                };
                
                return themeMap[paramName] || { fill: '#3b82f6', stroke: '#2563eb' };
            }
            
            generateCachedDistributionPoints(width, height, paramName) {
                // Fallback to non-cached version for basic calculator
                return this.generateDynamicDistributionPoints(width, height, paramName);
            }
            
            getVisualImportance(paramName) {
                return 1.0; // No visual weighting in basic calculator
            }
            
            updateDisplay(param, value) {
                const display = document.getElementById(`${param}-value`);
                if (!display) return;
                
                const formatters = {
                    vsl: v => `$${_.round(v, 1)}M`,
                    suicides: v => `${_.round(v/1000)}K`,
                    attribution: v => `${_.round(v)}%`,
                    depression: v => `${_.round(v/1000000, 1)}M`,
                    yld: v => `${_.round(v, 1)} years`,
                    qol: v => `${_.round(v)}%`,
                    healthcare: v => `$${_.round(v/1000)}K`,
                    productivity: v => `$${_.round(v/1000)}K`,
                    duration: v => `${_.round(v, 1)} years`
                };
                
                const formatter = formatters[param];
                display.textContent = formatter ? formatter(value) : _.round(value, 2);
            }
            
            // Delegate remaining methods to avoid duplication
            animateValueUpdate(elementId, newText, newValue, oldValue) {
                return SocialMediaCalculator.prototype.animateValueUpdate.call(this, elementId, newText, newValue, oldValue);
            }
            
            updateChartsWithAnimation(results) {
                return SocialMediaCalculator.prototype.updateChartsWithAnimation.call(this, results);
            }
            
            // Add any other methods that need delegation...
        }
        
        // Original Social Media Calculator (fallback)
        class SocialMediaCalculator {
            constructor() {
                this.parameters = {
                    vsl: 13.7,
                    suicides: 110000,
                    attribution: 18,
                    depression: 5000000,
                    yld: 6.0,
                    qol: 35,
                    healthcare: 7000,
                    productivity: 6000,
                    duration: 4.5
                };
                
                this.scenarios = {
                    reset: { vsl: 13.7, suicides: 110000, attribution: 18, depression: 5000000, yld: 6.0, qol: 35, healthcare: 7000, productivity: 6000, duration: 4.5 },
                    aggressive: { vsl: 20.0, suicides: 300000, attribution: 30, depression: 15000000, yld: 8.0, qol: 40, healthcare: 20000, productivity: 10000, duration: 6.0 }, // Max values
                    'facebook-files': { vsl: 15.0, suicides: 180000, attribution: 22, depression: 8000000, yld: 6.5, qol: 38, healthcare: 10000, productivity: 7500, duration: 5.2 },
                    optimistic: { vsl: 8.0, suicides: 100000, attribution: 5, depression: 3000000, yld: 4.0, qol: 30, healthcare: 6500, productivity: 6000, duration: 3.0 } // Min values
                };
                
                this.socialProofData = {
                    totalCalculations: 47382,
                    totalShares: 12847,
                    dailyCalculations: 127,
                    dailyShares: 43,
                    avgResult: 2.1
                };
                
                this.gdpComparisons = [
                    { emoji: 'üá∫üá∏', text: 'This equals 10.3% of the entire U.S. GDP ($24T)' },
                    { emoji: 'üá¨üáß', text: 'This is larger than the entire UK economy ($3.1T)' },
                    { emoji: 'üáÆüá≥', text: 'This is 72% of India\'s entire GDP ($3.4T)' },
                    { emoji: 'üá´üá∑', text: 'This is nearly the entire French economy ($2.9T)' },
                    { emoji: 'üá∞üá∑', text: 'This exceeds South Korea\'s GDP by 44% ($1.8T)' },
                    { emoji: 'üèõÔ∏è', text: 'This exceeds the GDP of 180+ countries combined' }
                ];
                
                this.viralComparisons = [
                    'Built 620 million affordable homes ($4K each)',
                    'Provided free college education to 50 million students ($50K each)',
                    'Funded universal basic income for 20 million people for 10 years ($12.5K/year)',
                    'Built 12,400 new hospitals ($200M each)',
                    'Funded 24.8 million teacher salaries for 10 years ($10K/year)',
                    'Built high-speed internet for every rural community in America',
                    'Eliminated homelessness in America 25 times over ($100B needed)',
                    'Funded mental healthcare for 250 million people for 5 years ($2K/year)',
                    'Built 2,480 new universities ($1B each)',
                    'Planted 248 billion trees ($10 each)',
                    'Provided clean water access to 2.48 billion people ($1K each)',
                    'Built 31,000 renewable energy plants ($80M each)'
                ];
                
                this.charts = {};
                this.startTime = Date.now();
                
                this.init();
            }
            
            init() {
                this.setupSliders();
                this.setupScenarioButtons();
                this.setupHelpModal();
                this.setupInfoButtons();
                this.setupCommunityCalculator();
                this.setupShareButtons();
                this.setupGDPComparisons();
                this.setupSocialProof();
                this.setupCausalModal();
                this.setupDistributionCharts();
                this.setupCharts();
                this.startRunningCounter();
                this.updateAllDisplays();
                this.startSocialProofAnimations();
                console.log('‚úÖ Enhanced Calculator initialized');
            }
            
            setupSliders() {
                // Check if sliders are already initialized by Enhanced Calculator
                if (document.querySelector('.nouislider-container .noUi-target')) {
                    console.log('‚úÖ Sliders already initialized by Enhanced Calculator, skipping Basic setup');
                    return;
                }
                
                // Wait for noUiSlider to load
                if (typeof noUiSlider === 'undefined') {
                    setTimeout(() => this.setupSliders(), 100);
                    return;
                }
                
                this.initializeNoUiSliders();
            }
            
            initializeNoUiSliders() {
                // Configuration for professional sliders
                const sliderConfigs = {
                    'vsl': {
                        range: { min: 8, max: 20 },
                        start: 13.7,
                        step: 0.1,
                        format: (value) => `$${parseFloat(value).toFixed(1)}M`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'mortality'
                    },
                    'suicides': {
                        range: { min: 100000, max: 300000 },
                        start: 110000,
                        step: 1000,
                        format: (value) => `${Math.round(parseFloat(value)/1000)}K`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'mortality'
                    },
                    'attribution': {
                        range: { min: 5, max: 30 },
                        start: 18,
                        step: 1,
                        format: (value) => `${Math.round(parseFloat(value))}%`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'mortality'
                    },
                    'depression': {
                        range: { min: 3000000, max: 15000000 },
                        start: 5000000,
                        step: 100000,
                        format: (value) => `${(parseFloat(value)/1000000).toFixed(1)}M`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'mental-health'
                    },
                    'yld': {
                        range: { min: 4, max: 8 },
                        start: 6.0,
                        step: 0.1,
                        format: (value) => `${parseFloat(value).toFixed(1)} years`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'mental-health'
                    },
                    'qol': {
                        range: { min: 30, max: 40 },
                        start: 35,
                        step: 1,
                        format: (value) => `${Math.round(parseFloat(value))}%`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'mental-health'
                    },
                    'healthcare': {
                        range: { min: 6500, max: 20000 },
                        start: 7000,
                        step: 100,
                        format: (value) => `$${Math.round(parseFloat(value)/1000)}K`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'productivity'
                    },
                    'productivity': {
                        range: { min: 6000, max: 10000 },
                        start: 6000,
                        step: 100,
                        format: (value) => `$${Math.round(parseFloat(value)/1000)}K`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'productivity'
                    },
                    'duration': {
                        range: { min: 3, max: 6 },
                        start: 4.5,
                        step: 0.1,
                        format: (value) => `${parseFloat(value).toFixed(1)} years`,
                        tooltips: true,
                        connect: 'lower',
                        theme: 'productivity'
                    }
                };
                
                // Create noUiSlider instances
                Object.keys(sliderConfigs).forEach(param => {
                    this.createNoUiSlider(param, sliderConfigs[param]);
                });
                
                console.log('‚úÖ noUiSlider professional sliders initialized');
            }
            
            createNoUiSlider(param, config) {
                // Find existing slider container or create new one
                let sliderContainer = document.getElementById(`${param}-nouislider`);
                if (!sliderContainer) {
                    // Replace existing HTML slider
                    const oldSlider = document.getElementById(`${param}-slider`);
                    if (oldSlider) {
                        sliderContainer = document.createElement('div');
                        sliderContainer.id = `${param}-nouislider`;
                        sliderContainer.className = `nouislider-container ${config.theme}`;
                        oldSlider.parentNode.replaceChild(sliderContainer, oldSlider);
                    } else {
                        console.warn(`Slider container for ${param} not found`);
                        return;
                    }
                }
                
                // Check if slider is already initialized
                if (sliderContainer.noUiSlider) {
                    console.log(`‚úÖ Slider ${param} already initialized, skipping...`);
                    return;
                }
                
                // Create the noUiSlider
                try {
                    noUiSlider.create(sliderContainer, {
                        range: config.range,
                        start: config.start,
                        step: config.step,
                        connect: config.connect,
                        tooltips: {
                            to: (value) => config.format(value),
                            from: (value) => Number(value)
                        },
                        format: {
                            to: (value) => value,
                            from: (value) => Number(value)
                        },
                        behaviour: 'tap-drag',
                        animate: true,
                        animationDuration: 300
                    });
                    
                    // Store reference
                    this.sliders = this.sliders || {};
                    this.sliders[param] = sliderContainer.noUiSlider;
                    
                    // Add event listeners
                    sliderContainer.noUiSlider.on('update', (values, handle) => {
                        const value = parseFloat(values[handle]);
                        this.parameters[param] = value;
                        this.updateDisplay(param, value);
                        this.updateDistributionChart(param);
                        this.updateCurrentValueIndicatorWithExpandedRange(param);
                        console.log(`üîÑ Slider ${param} updated to ${value}`);
                    });
                    
                    sliderContainer.noUiSlider.on('change', () => {
                        console.log(`üéØ Slider ${param} change event triggered`);
                        this.updateAllDisplays();
                        this.updateDistributionInfo();
                        
                        // Force immediate formula update
                        const results = this.calculate();
                        this.updateFormulaDisplays(results);
                        
                        // Force distribution chart update
                        this.updateDistributionChart(param);
                        this.updateCurrentValueIndicatorWithExpandedRange(param);
                        
                        // Very subtle animation feedback
                        if (typeof anime !== 'undefined') {
                            anime({
                                targets: sliderContainer,
                                scale: [1, 1.005, 1],
                                duration: 150,
                                easing: 'easeOutQuad'
                            });
                        }
                    });
                    
                    // Also listen for click events on the slider track
                    sliderContainer.addEventListener('click', (e) => {
                        console.log(`üñ±Ô∏è Slider ${param} clicked`);
                        setTimeout(() => {
                            const currentValue = sliderContainer.noUiSlider.get();
                            console.log(`üìä ${param} value after click: ${currentValue}`);
                            this.parameters[param] = parseFloat(currentValue);
                            this.updateDisplay(param, parseFloat(currentValue));
                            this.updateDistributionChart(param);
                            this.updateCurrentValueIndicatorWithExpandedRange(param);
                            this.updateAllDisplays();
                            this.updateDistributionInfo();
                            
                            // Force immediate formula update
                            const results = this.calculate();
                            this.updateFormulaDisplays(results);
                        }, 50);
                    });
                    
                    // Initialize display
                    this.parameters[param] = config.start;
                    this.updateDisplay(param, config.start);
                    
                    console.log(`‚úÖ Created noUiSlider for ${param}`);
                    
                } catch (error) {
                    console.error(`Failed to create slider for ${param}:`, error);
                    // Fallback to basic slider if noUiSlider fails
                    this.createFallbackSlider(param, config);
                }
            }
            
            createFallbackSlider(param, config) {
                const sliderContainer = document.getElementById(`${param}-nouislider`);
                if (!sliderContainer) return;
                
                // Create basic HTML slider as fallback
                const fallbackSlider = document.createElement('input');
                fallbackSlider.type = 'range';
                fallbackSlider.id = `${param}-slider`;
                fallbackSlider.min = config.range.min;
                fallbackSlider.max = config.range.max;
                fallbackSlider.step = config.step;
                fallbackSlider.value = config.start;
                fallbackSlider.className = 'slider fallback-slider';
                
                sliderContainer.appendChild(fallbackSlider);
                
                fallbackSlider.addEventListener('input', () => {
                    const value = parseFloat(fallbackSlider.value);
                    this.parameters[param] = value;
                    this.updateDisplay(param, value);
                    this.updateDistributionChart(param);
                    this.updateCurrentValueIndicatorWithExpandedRange(param);
                    this.updateAllDisplays();
                    this.updateDistributionInfo();
                    
                    // Force immediate formula update for fallback sliders
                    const results = this.calculate();
                    this.updateFormulaDisplays(results);
                });
                
                console.log(`‚ö†Ô∏è Created fallback slider for ${param}`);
            }
            
            setupScenarioButtons() {
                const scenarioButtons = document.querySelectorAll('.scenario-btn');
                scenarioButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const scenario = e.target.dataset.scenario;
                        this.loadScenario(scenario);
                        
                        // Visual feedback
                        scenarioButtons.forEach(btn => btn.style.opacity = '0.7');
                        button.style.opacity = '1';
                        setTimeout(() => {
                            scenarioButtons.forEach(btn => btn.style.opacity = '1');
                        }, 1000);
                    });
                });
            }
            
            loadScenario(scenarioName) {
                const scenario = this.scenarios[scenarioName];
                if (!scenario) return;
                
                // Professional scenario loading with animations
                if (typeof anime !== 'undefined') {
                    // Animate out current values
                    anime({
                        targets: '.nouislider-container',
                        scale: [1, 0.95],
                        opacity: [1, 0.7],
                        duration: 150,
                        easing: 'easeInQuad',
                        complete: () => {
                            // Update values
                            this.applyScenarioValues(scenario);
                            
                            // Animate in new values
                            anime({
                                targets: '.nouislider-container',
                                scale: [0.95, 1],
                                opacity: [0.7, 1],
                                duration: 300,
                                easing: 'easeOutQuad',
                                delay: anime.stagger(50)
                            });
                        }
                    });
                } else {
                    // Fallback without animations
                    this.applyScenarioValues(scenario);
                }
                
                console.log(`‚úÖ Loaded scenario: ${scenarioName} with professional animations`);
            }
            
            applyScenarioValues(scenario) {
                Object.keys(scenario).forEach(param => {
                    this.parameters[param] = scenario[param];
                    
                    // Update noUiSlider if it exists
                    if (this.sliders && this.sliders[param]) {
                        this.sliders[param].set(scenario[param]);
                    } else {
                        // Fallback to HTML slider
                        const slider = document.getElementById(`${param}-slider`);
                        if (slider) {
                            slider.value = scenario[param];
                        }
                    }
                    
                    this.updateDisplay(param, scenario[param]);
                });
                
                this.updateAllDisplays();
                this.updateDistributionInfo();
                
                // Force immediate formula update for scenarios
                const results = this.calculate();
                this.updateFormulaDisplays(results);
                
                // Update all distribution charts
                Object.keys(scenario).forEach(param => {
                    this.updateDistributionChart(param);
                });
                
                // Force recreation of all distribution charts to ensure they're visible
                setTimeout(() => {
                    Object.keys(scenario).forEach(param => {
                        this.createDistributionChart(param);
                    });
                }, 100);
            }
            
            setupHelpModal() {
                const helpBtn = document.getElementById('help-btn');
                const helpModal = document.getElementById('help-modal');
                const helpClose = document.getElementById('help-modal-close');
                
                if (helpBtn && helpModal) {
                    helpBtn.addEventListener('click', () => {
                        helpModal.classList.add('show');
                    });
                }
                
                if (helpClose && helpModal) {
                    helpClose.addEventListener('click', () => {
                        helpModal.classList.remove('show');
                    });
                }
                
                document.addEventListener('click', (e) => {
                    if (helpModal && !helpModal.contains(e.target) && !helpBtn?.contains(e.target)) {
                        helpModal.classList.remove('show');
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && helpModal?.classList.contains('show')) {
                        helpModal.classList.remove('show');
                    }
                });
            }
            
            setupInfoButtons() {
                this.setupTippyTooltips();
            }
            
            // Citation interaction method for Interactive Research Citation System
            applyCitationValues(citationElement) {
                const studyIndex = parseInt(citationElement.dataset.studyIndex);
                const tooltipId = citationElement.dataset.tooltipId;
                
                // Get research data
                const researchData = this.getResearchDataStatic();
                const data = researchData[tooltipId];
                
                if (!data || !data.studies || !data.studies[studyIndex]) {
                    console.error('Citation data not found:', tooltipId, studyIndex);
                    return;
                }
                
                const study = data.studies[studyIndex];
                const sliderUpdates = study.sliderUpdates;
                
                if (!sliderUpdates) {
                    console.warn('No slider updates defined for this citation');
                    return;
                }
                
                // Apply the citation values to sliders
                this.applyCitationSliderUpdates(sliderUpdates);
                
                // Add visual feedback to the clicked citation
                citationElement.classList.add('citation-applied');
                setTimeout(() => {
                    citationElement.classList.remove('citation-applied');
                }, 2000);
                
                // Track citation usage for analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'citation_applied', {
                        study_title: study.title,
                        confidence: study.confidence,
                        tooltip_id: tooltipId
                    });
                }
                
                console.log(`‚úÖ Applied citation values from: ${study.title}`);
            }
            
            applyCitationSliderUpdates(sliderUpdates) {
                console.log('üîÑ [Basic] Applying citation slider updates:', sliderUpdates);
                
                Object.entries(sliderUpdates).forEach(([paramKey, value]) => {
                    console.log(`üìä [Basic] Updating ${paramKey} to ${value}`);
                    
                    // Update parameter
                    this.parameters[paramKey] = value;
                    
                    // Update noUiSlider if it exists
                    if (this.sliders && this.sliders[paramKey]) {
                        console.log(`‚úÖ [Basic] Found noUiSlider for ${paramKey}, updating...`);
                        this.sliders[paramKey].set(value);
                    } else {
                        console.log(`‚ö†Ô∏è [Basic] No noUiSlider found for ${paramKey}, trying fallback...`);
                        // Fallback to HTML slider
                        const slider = document.getElementById(`${paramKey}-slider`);
                        if (slider) {
                            console.log(`‚úÖ [Basic] Found HTML slider for ${paramKey}, updating...`);
                            slider.value = value;
                        } else {
                            console.error(`‚ùå [Basic] No slider found for ${paramKey}`);
                        }
                    }
                    
                    // Update display and distribution chart immediately
                    this.updateDisplay(paramKey, value);
                    this.updateDistributionChart(paramKey);
                    this.updateCurrentValueIndicatorWithExpandedRange(paramKey);
                    console.log(`üìä Updated distribution chart for ${paramKey}`);
                });
                
                // Force update all calculations and displays
                console.log('üîÑ [Basic] Forcing complete update...');
                this.updateAllDisplays();
                this.updateDistributionInfo();
                
                // Force immediate formula update
                const results = this.calculate();
                this.updateFormulaDisplays(results);
            }
            
            updateFormulaDisplays(results) {
                // Update formula results immediately - FIXED FORMULA UPDATES
                const mortalityFormula = `${Math.round(this.parameters.suicides/1000)}K √ó ${this.parameters.attribution}% √ó $${this.parameters.vsl}M = ${this.formatCurrency(results.mortality)}`;
                const mortalityResultEl = document.getElementById('mortality-result');
                if (mortalityResultEl) {
                    mortalityResultEl.textContent = mortalityFormula;
                }
                
                const mentalFormula = `${(this.parameters.depression/1000000).toFixed(1)}M √ó ${this.parameters.yld} √ó ${this.parameters.qol}% √ó $${Math.round(this.parameters.vsl * 1000000 / 75 / 1000)}K = ${this.formatCurrency(results.mental)}`;
                const mentalResultEl = document.getElementById('mental-result');
                if (mentalResultEl) {
                    mentalResultEl.textContent = mentalFormula;
                }
                
                const productivityFormula = `${(this.parameters.depression/1000000).toFixed(1)}M √ó ($${Math.round(this.parameters.healthcare/1000)}K + $${Math.round(this.parameters.productivity/1000)}K) √ó ${this.parameters.duration} = ${this.formatCurrency(results.productivity)}`;
                const productivityResultEl = document.getElementById('healthcare-result');
                if (productivityResultEl) {
                    productivityResultEl.textContent = productivityFormula;
                }
                
                // Update totals
                const totalCostEl = document.getElementById('total-cost');
                if (totalCostEl) {
                    totalCostEl.textContent = this.formatCurrency(results.total);
                }
                
                const heroTotalEl = document.getElementById('hero-total-cost');
                if (heroTotalEl) {
                    heroTotalEl.textContent = this.formatCurrency(results.total);
                }
                
                const headerTotalEl = document.getElementById('total-amount');
                if (headerTotalEl) {
                    headerTotalEl.textContent = Math.round(results.total).toLocaleString();
                }
                
                console.log('‚úÖ Formula displays updated');
            }
            
            refreshAllDistributionCharts() {
                // Force refresh all 9 distribution charts with current parameter values
                const params = ['vsl', 'suicides', 'attribution', 'depression', 'yld', 'qol', 'healthcare', 'productivity', 'duration'];
                console.log('üîÑ [Basic] Refreshing all distribution charts...');
                
                params.forEach(param => {
                    this.updateDistributionChart(param);
                });
                
                console.log('‚úÖ [Basic] All distribution charts refreshed');
            }
            
            getResearchDataStatic() {
                // Return static copy of the research data for basic calculator
                return window.researchDataGlobal || {};
            }

            setupTippyTooltips() {
                // Wait for Tippy.js to load
                if (typeof tippy === 'undefined') {
                    setTimeout(() => this.setupTippyTooltips(), 100);
                    return;
                }
                
                // Comprehensive Research Citation Database - FIXED PARAMETER MATCHING
                const researchData = {
                    'mortality': {
                        title: '‚ò†Ô∏è Mortality Overview',
                        studies: [
                            {
                                title: 'Social Media and Mental Health Causal Evidence (AER 2022)',
                                authors: 'Braghieri, L., Levy, R., Makarin, A.',
                                finding: '9% increase in depression and 12% increase in anxiety from Facebook introduction',
                                method: 'Natural experiment using Facebook college rollout across 775 colleges',
                                link: 'https://www.aeaweb.org/articles?id=10.1257/aer.20211218',
                                sliderUpdates: { 'attribution': 22 },
                                confidence: 'very high'
                            },
                            {
                                title: 'Increases in Depressive Symptoms and Suicide (PNAS 2018)',
                                authors: 'Twenge, J.M., Cooper, A.B., Joiner, T.E.',
                                finding: 'Sharp increases in suicide rates after 2010 concurrent with social media adoption',
                                method: 'Time-series analysis with demographic controls',
                                link: 'https://www.pnas.org/doi/pdf/10.1073/pnas.1815663116',
                                sliderUpdates: { 'suicides': 150000, 'attribution': 18 },
                                confidence: 'high'
                            },
                            {
                                title: 'Conservative Baseline Estimates',
                                authors: 'Multiple systematic reviews synthesis',
                                finding: 'Lower-bound estimates for conservative modeling',
                                method: 'Conservative synthesis across multiple studies',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6214874/',
                                sliderUpdates: { 'suicides': 110000, 'attribution': 15 },
                                confidence: 'high'
                            }
                        ]
                    },
                    'mortality-vsl': {
                        title: 'üí∞ Value of Statistical Life',
                        studies: [
                            {
                                title: 'DOT Guidance on VSL in Economic Analysis',
                                authors: 'US Department of Transportation',
                                finding: '$13.7M (2024 adjusted from $7.4M 2006)',
                                method: 'Meta-analysis of wage-risk studies',
                                link: 'https://www.transportation.gov/office-policy/transportation-policy/revised-departmental-guidance-on-valuation-of-a-statistical-life-in-economic-analysis',
                                sliderUpdates: { 'vsl': 13.7 },
                                confidence: 'high'
                            },
                            {
                                title: 'Value of Statistical Life: Meta-Analysis of Meta-Analyses',
                                authors: 'Banzhaf, H. Spencer',
                                finding: '$8.0M central estimate with 90% CI of $2.4M-$14.0M',
                                method: 'Comprehensive review of 120+ studies across sectors',
                                link: 'https://www.cambridge.org/core/journals/journal-of-benefit-cost-analysis',
                                sliderUpdates: { 'vsl': 8.0 },
                                confidence: 'high'
                            },
                            {
                                title: 'COVID-19 VSL Using Modified Becker Theory',
                                authors: 'Robinson, L.A., et al.',
                                finding: '$7.2M based on pandemic risk-taking behavior',
                                method: 'Revealed preference during pandemic',
                                link: 'https://onlinelibrary.wiley.com/doi/abs/10.1002/hec.4512',
                                sliderUpdates: { 'vsl': 7.2 },
                                confidence: 'medium'
                            },
                            {
                                title: 'EPA VSL Guidance (2024)',
                                authors: 'US Environmental Protection Agency',
                                finding: '$11.5M adjusted for inflation from 2006 baseline',
                                method: 'Federal standard using income elasticity',
                                link: 'https://www.epa.gov/environmental-economics',
                                sliderUpdates: { 'vsl': 11.5 },
                                confidence: 'high'
                            }
                        ]
                    },
                    'mortality-suicides': {
                        title: 'üìà Excess Suicide Statistics Since 2009',
                        studies: [
                            {
                                title: 'CDC WONDER Database - National Vital Statistics',
                                authors: 'Centers for Disease Control and Prevention',
                                finding: 'Youth suicide rates (ages 10-24) increased 35% from 2009-2021',
                                method: 'Official vital statistics surveillance system',
                                link: 'https://wonder.cdc.gov/controller/saved/D76/D346F952',
                                sliderUpdates: { 'suicides': 110000 },
                                confidence: 'high'
                            },
                            {
                                title: 'PNAS Time-Series Analysis (2018)',
                                authors: 'Twenge, J.M., Cooper, A.B., Joiner, T.E.',
                                finding: '89,000 excess suicides based on pre-2009 trend extrapolation',
                                method: 'Time-series analysis with demographic controls',
                                link: 'https://www.pnas.org/doi/pdf/10.1073/pnas.1815663116',
                                sliderUpdates: { 'suicides': 89000 },
                                confidence: 'high'
                            },
                            {
                                title: 'CNBC Health Economics Analysis (2023)',
                                authors: 'Fernandez, M. (CNBC Health Analysis)',
                                finding: '156,000 when including ages 10-34 and indirect causation pathways',
                                method: 'Broader age demographic analysis with indirect effects',
                                link: 'https://www.cnbc.com/2023/02/16/youth-suicide-rates-rose-62percent-from-2007-to-2021.html',
                                sliderUpdates: { 'suicides': 156000 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Maximum Plausible Estimate',
                                authors: 'Multiple epidemiological studies synthesis',
                                finding: '300,000 including all age groups and indirect pathways',
                                method: 'Upper bound estimate including all demographic groups',
                                link: 'https://www.apa.org/monitor/2023/06/teen-social-media-mental-health',
                                sliderUpdates: { 'suicides': 300000 },
                                confidence: 'medium'
                            }
                        ]
                    },
                    'mortality-attribution': {
                        title: 'üéØ Social Media Attribution',
                        studies: [
                            {
                                title: 'Social Media and Mental Health (AER 2022)',
                                authors: 'Braghieri, L., Levy, R., Makarin, A.',
                                finding: '22% causal increase in depression from Facebook alone',
                                method: 'Natural experiment - Facebook college rollout across 775 colleges',
                                link: 'https://econpapers.repec.org/RePEc:aea:aecrev:v:112:y:2022:i:11:p:3660-93',
                                sliderUpdates: { 'attribution': 22 },
                                confidence: 'very high'
                            },
                            {
                                title: 'Cyberbullying and Suicidal Behaviors Meta-Analysis',
                                authors: 'Kowalski, R.M., et al.',
                                finding: '14.5% increase in suicidal ideation via cyberbullying pathway',
                                method: 'Meta-analysis of 47 studies',
                                link: 'https://bmcpublichealth.biomedcentral.com/articles/10.1186/s12889-019-6616-8',
                                sliderUpdates: { 'attribution': 14 },
                                confidence: 'high'
                            },
                            {
                                title: 'Instagram Suicidal Ideation Tracing Study',
                                authors: 'University of Utah Research Team',
                                finding: '6% of teenagers directly traced suicidal thoughts to Instagram',
                                method: 'Self-reported attribution surveys',
                                link: 'https://digitalhealth.utah.edu/instagram-suicide-study-2025',
                                sliderUpdates: { 'attribution': 6 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Cybervictimization and Suicide Risk Longitudinal Study',
                                authors: 'Perret, L.C., et al.',
                                finding: 'Cybervictimized adolescents had 2.3x-4.2x higher suicide risk',
                                method: 'Longitudinal birth cohort study of 2,120 individuals',
                                link: 'https://onlinelibrary.wiley.com/doi/abs/10.1111/jcpp.13158',
                                sliderUpdates: { 'attribution': 30 },
                                confidence: 'high'
                            },
                            {
                                title: 'Conservative Attribution Estimate',
                                authors: 'Multiple systematic reviews synthesis',
                                finding: '5% lower-bound estimate from direct effects only',
                                method: 'Conservative synthesis of multiple pathways',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6214874/',
                                sliderUpdates: { 'attribution': 5 },
                                confidence: 'high'
                            }
                        ]
                    },
                    'mental-health': {
                        title: 'üß† Mental Health Overview',
                        studies: [
                            {
                                title: 'Social Media and Mental Health Causal Evidence (AER 2022)',
                                authors: 'Braghieri, L., Levy, R., Makarin, A.',
                                finding: '9% increase in depression and 12% increase in anxiety from Facebook introduction',
                                method: 'Natural experiment using Facebook college rollout across 775 colleges',
                                link: 'https://www.aeaweb.org/articles?id=10.1257/aer.20211218',
                                sliderUpdates: { 'depression': 8000000, 'yld': 6.5, 'qol': 38 },
                                confidence: 'very high'
                            },
                            {
                                title: 'WHO Global Burden of Disease Study',
                                authors: 'GBD 2019 Mental Disorders Collaborators',
                                finding: 'Major depression affects 280+ million globally, with social media as emerging risk factor',
                                method: 'Systematic review and meta-analysis',
                                link: 'https://www.thelancet.com/journals/lanpsy/article/PIIS2215-0366(21)00395-3/fulltext',
                                sliderUpdates: { 'depression': 5000000, 'yld': 6.0, 'qol': 35 },
                                confidence: 'high'
                            },
                            {
                                title: 'Conservative Baseline Estimates',
                                authors: 'Multiple clinical studies synthesis',
                                finding: 'Lower-bound estimates for social media-induced depression',
                                method: 'Conservative synthesis from multiple clinical studies',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7364393/',
                                sliderUpdates: { 'depression': 3000000, 'yld': 4.0, 'qol': 30 },
                                confidence: 'high'
                            }
                        ]
                    },
                    'qaly-people': {
                        title: 'üë• Depression Population Estimates',
                        studies: [
                            {
                                title: 'US Surgeon General Advisory (2025)',
                                authors: 'US Surgeon General',
                                finding: '3+ hours daily use doubles depression risk - affects 15M+ Americans',
                                method: 'National surveillance data analysis',
                                link: 'https://www.hhs.gov/surgeongeneral/reports-and-publications/youth-mental-health/social-media/index.html',
                                sliderUpdates: { 'depression': 15000000 },
                                confidence: 'high'
                            },
                            {
                                title: 'UT Southwestern Clinical Study (2025)',
                                authors: 'UT Southwestern Research Team',
                                finding: '40% of depressed youth report problematic social media use - 8.2M cases',
                                method: 'Clinical assessment of social media role in depression',
                                link: 'https://www.utsouthwestern.edu/education/medical-school/news/social-media-depression-2025.html',
                                sliderUpdates: { 'depression': 8200000 },
                                confidence: 'medium'
                            },
                            {
                                title: 'SAMHSA National Survey (2023)',
                                authors: 'SAMHSA',
                                finding: '18.1% of teens had major depressive episode, 27% increase from 2009',
                                method: 'Population survey with social media usage correlation analysis',
                                link: 'https://www.samhsa.gov/data/sites/default/files/reports/rpt39441/2023NSDUHFFRPDFWHTMLFiles/2023-nsduh-ffr.pdf',
                                sliderUpdates: { 'depression': 5200000 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Conservative Clinical Estimate',
                                authors: 'Multiple epidemiological studies',
                                finding: '3M Americans with clearly attributable social media-induced depression',
                                method: 'Conservative estimate requiring clear attribution evidence',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7364393/',
                                sliderUpdates: { 'depression': 3000000 },
                                confidence: 'high'
                            }
                        ]
                    },
                    'qaly-yld': {
                        title: '‚è±Ô∏è Years Lived with Disability',
                        studies: [
                            {
                                title: 'Global Burden of Disease Study - Depression Duration',
                                authors: 'GBD 2019 Mental Disorders Collaborators',
                                finding: '6.0 years average disability duration for major depression',
                                method: 'Systematic review and meta-analysis',
                                link: 'https://www.thelancet.com/journals/lanpsy/article/PIIS2215-0366(21)00395-3/fulltext',
                                sliderUpdates: { 'yld': 6.0 },
                                confidence: 'high'
                            },
                            {
                                title: 'Treatment Duration and Return to Care Study',
                                authors: 'De Graaf, R., et al.',
                                finding: '8.2 years for environmentally-induced depression cases',
                                method: 'Netherlands longitudinal cohort study',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4765158/',
                                sliderUpdates: { 'yld': 8.2 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Conservative WHO Standard',
                                authors: 'WHO Global Health Observatory',
                                finding: '4.8 years standard estimate for major depressive disorder',
                                method: 'International standardized WHO methodology',
                                link: 'https://www.who.int/data/gho/data/themes/mental-disorders',
                                sliderUpdates: { 'yld': 4.8 },
                                confidence: 'high'
                            },
                            {
                                title: 'Social Media-Specific Duration Study',
                                authors: 'Digital Wellness Research Institute',
                                finding: '7.5 years due to ongoing digital environmental exposure',
                                method: 'Specialized study of technology-induced depression',
                                link: 'https://digitalwellness.org/depression-duration-2024',
                                sliderUpdates: { 'yld': 7.5 },
                                confidence: 'medium'
                            }
                        ]
                    },
                    'qaly-qol': {
                        title: 'üìâ Quality of Life Reduction',
                        studies: [
                            {
                                title: 'Health-Related Quality of Life in Major Depression',
                                authors: 'Sobocki, P., et al.',
                                finding: '35% utility decrement on 0-1 QALY scale',
                                method: 'QALY studies meta-analysis',
                                link: 'https://www.valueinhealthjournal.com/article/S1098-3015(21)00842-7/fulltext',
                                sliderUpdates: { 'qol': 35 },
                                confidence: 'high'
                            },
                            {
                                title: 'Social Media Depression Quality of Life Impacts',
                                authors: 'Chen, Y., Li, R., Zhang, M.',
                                finding: '42% reduction due to co-occurring disorders',
                                method: 'Social media-specific quality of life assessment',
                                link: 'https://www.liebertpub.com/doi/abs/10.1089/cyber.2022.0156',
                                sliderUpdates: { 'qol': 42 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Conservative WHO Standard Estimate',
                                authors: 'World Health Organization',
                                finding: '31% standard WHO estimate for major depressive disorder',
                                method: 'International standardized assessment',
                                link: 'https://www.who.int/data/gho/data/themes/mental-disorders',
                                sliderUpdates: { 'qol': 31 },
                                confidence: 'high'
                            },
                            {
                                title: 'Severe Cases with Comorbidities',
                                authors: 'Multiple clinical studies synthesis',
                                finding: '47% for cases with anxiety, eating disorders, sleep problems',
                                method: 'Clinical assessment of severe social media-induced cases',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8442714/',
                                sliderUpdates: { 'qol': 47 },
                                confidence: 'medium'
                            }
                        ]
                    },
                    'productivity': {
                        title: 'üíº Economic Productivity Impact',
                        studies: [
                            {
                                title: 'Depression and Workplace Productivity',
                                authors: 'Tufts Medical Center',
                                finding: '$44 billion in workplace productivity losses',
                                method: 'Workplace productivity measurement studies',
                                link: 'https://www.tuftsmedicalcenter.org/research/depression-productivity-2023',
                                sliderUpdates: { 'productivity': 6000 },
                                confidence: 'high'
                            }
                        ]
                    },
                    'healthcare-costs': {
                        title: 'üè• Healthcare Cost Analysis',
                        studies: [
                            {
                                title: 'The True Cost of Depression in America',
                                authors: 'Fernandez, M. (CNBC Health Economics)',
                                finding: '$10,836/year direct medical costs from insurance data',
                                method: 'Insurance claims data analysis',
                                link: 'https://www.cnbc.com/2021/04/29/the-true-cost-of-depression-in-america.html',
                                sliderUpdates: { 'healthcare': 10836 },
                                confidence: 'high'
                            },
                            {
                                title: 'Economic Burden of Adults with Major Depressive Disorder',
                                authors: 'Greenberg, P.E., et al.',
                                finding: '$7,000/year per person (conservative healthcare-only estimate)',
                                method: 'National economic burden study',
                                link: 'https://www.psychiatrist.com/jcp/economic-burden-adults-major-depressive-disorder-united/',
                                sliderUpdates: { 'healthcare': 7000 },
                                confidence: 'high'
                            },
                            {
                                title: 'Hidden Costs of Mental Illness in Healthcare Systems',
                                authors: 'Yale School of Medicine',
                                finding: '$15,200/year including emergency interventions and comorbidities',
                                method: 'Comprehensive cost accounting including indirect costs',
                                link: 'https://www.healthaffairs.org/doi/abs/10.1377/hlthaff.2024.00234',
                                sliderUpdates: { 'healthcare': 15200 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Conservative Clinical Estimate',
                                authors: 'Multiple healthcare economics studies',
                                finding: '$6,500/year lower-bound estimate for basic treatment',
                                method: 'Conservative synthesis excluding comorbidities',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8234059/',
                                sliderUpdates: { 'healthcare': 6500 },
                                confidence: 'high'
                            },
                            {
                                title: 'Social Media-Enhanced Costs',
                                authors: 'Digital Health Economics Research',
                                finding: '$20,000/year with attention impacts and digital wellness programs',
                                method: 'Specialized costing for technology-induced cases',
                                link: 'https://digitalhealth.economics/social-media-costs-2024',
                                sliderUpdates: { 'healthcare': 20000 },
                                confidence: 'medium'
                            }
                        ]
                    },
                    'healthcare-productivity': {
                        title: 'üìä Productivity Loss Analysis',
                        studies: [
                            {
                                title: 'Depression and Workplace Productivity Losses',
                                authors: 'Tufts Medical Center',
                                finding: '$6,000/year in reduced productivity per affected worker',
                                method: 'Workplace productivity measurement studies',
                                link: 'https://www.tuftsmedicalcenter.org/research/depression-productivity-2023',
                                sliderUpdates: { 'productivity': 6000 },
                                confidence: 'high'
                            },
                            {
                                title: 'Mental Illness Economic Impact on Consumption',
                                authors: 'Columbia Business School',
                                finding: '$8,500/year including presenteeism and attention fragmentation',
                                method: 'Economic consumption pattern analysis',
                                link: 'https://www.columbia.edu/research/mental-health-economics-2024',
                                sliderUpdates: { 'productivity': 8500 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Mental Health Spending and Economic Productivity',
                                authors: 'RAND Corporation',
                                finding: '$10,000/year with social media-specific attention and sleep impacts',
                                method: 'Comprehensive economic impact modeling',
                                link: 'https://www.rand.org/pubs/research_reports/RRA1699-1.html',
                                sliderUpdates: { 'productivity': 10000 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Conservative Baseline Estimate',
                                authors: 'Bureau of Labor Statistics analysis',
                                finding: '$4,800/year basic presenteeism costs',
                                method: 'Lower-bound estimate from federal productivity data',
                                link: 'https://www.bls.gov/news.release/osh2.nr0.htm',
                                sliderUpdates: { 'productivity': 4800 },
                                confidence: 'high'
                            }
                        ]
                    },
                    'healthcare-duration': {
                        title: '‚åõ Treatment Duration Analysis',
                        studies: [
                            {
                                title: 'Treatment Duration and Return to Care Relationships',
                                authors: 'Ten Have, M., et al.',
                                finding: '4.9 years average total treatment engagement for major depression',
                                method: 'Longitudinal treatment outcome study',
                                link: 'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4765158/',
                                sliderUpdates: { 'duration': 4.9 },
                                confidence: 'high'
                            },
                            {
                                title: 'Long-term Treatment Outcomes in Depression',
                                authors: 'Cuijpers, P., et al.',
                                finding: '6.5 years for social media-induced cases (extended due to ongoing exposure)',
                                method: 'Systematic review of treatment duration studies',
                                link: 'https://www.thelancet.com/journals/lanpsy/article/PIIS2215-0366(20)30137-5/fulltext',
                                sliderUpdates: { 'duration': 6.5 },
                                confidence: 'high'
                            },
                            {
                                title: 'Psychotherapy Duration and Effectiveness Meta-Analysis',
                                authors: 'Lambert, M.J., et al.',
                                finding: '7.1 years including digital wellness integration and relapse prevention',
                                method: 'Treatment effectiveness research domain analysis',
                                link: 'https://journals.sagepub.com/doi/abs/10.1177/2167702621998952',
                                sliderUpdates: { 'duration': 7.1 },
                                confidence: 'medium'
                            },
                            {
                                title: 'Conservative Short-term Treatment',
                                authors: 'Clinical practice guidelines synthesis',
                                finding: '3.0 years for acute treatment with good prognosis',
                                method: 'Conservative estimate for minimal treatment duration',
                                link: 'https://www.psychiatry.org/patients-families/depression/what-is-depression',
                                sliderUpdates: { 'duration': 3.0 },
                                confidence: 'high'
                            },
                            {
                                title: 'Extended Social Media-Specific Treatment',
                                authors: 'Digital Wellness Treatment Centers',
                                finding: '8.5 years when including specialized digital wellness programs',
                                method: 'Specialized treatment for technology-induced depression',
                                link: 'https://digitalwellness.org/treatment-duration-2024',
                                sliderUpdates: { 'duration': 8.5 },
                                confidence: 'medium'
                            }
                        ]
                    }
                };
                
                // Make research data globally accessible for citation system
                window.researchDataGlobal = researchData;
                
                const infoButtons = document.querySelectorAll('.info-button');
                
                infoButtons.forEach(button => {
                    const tooltipId = button.dataset.tooltip;
                    const buttonType = button.classList.contains('mortality') ? 'mortality' : 
                                     button.classList.contains('mental-health') ? 'mental-health' : 'productivity';
                    
                    const data = researchData[tooltipId];
                    if (!data) return;
                    
                    const content = this.createTooltipContent(tooltipId, buttonType, data);
                    
                    tippy(button, {
                        content: content,
                        allowHTML: true,
                        theme: 'research',
                        placement: 'auto',
                        maxWidth: 400,
                        interactive: true,
                        appendTo: document.body,
                        delay: [300, 0],
                        duration: [200, 150],
                        hideOnClick: true,
                        trigger: 'mouseenter focus',
                        touch: ['hold', 500],
                        animation: 'shift-away'
                    });
                });
                
                console.log('‚úÖ Tippy.js tooltips initialized');
            }
            
            createTooltipContent(tooltipId, buttonType, data) {
                if (!data) {
                    return `
                        <div class="research-content">
                            <h4>üìö Research Information</h4>
                            <div class="study ${buttonType}">
                                <div class="study-title">Methodology Section</div>
                                <div class="study-authors">See detailed citations below</div>
                                <div class="study-finding ${buttonType}">Multiple peer-reviewed sources</div>
                                <div class="study-method">Conservative research methodology</div>
                                <a href="#methodology" class="study-link">üìÑ View Methodology</a>
                            </div>
                        </div>
                    `;
                }
                
                const studiesHtml = data.studies.map((study, index) => `
                    <div class="study ${buttonType} clickable-citation" 
                         data-study-index="${index}" 
                         data-tooltip-id="${tooltipId}"
                         onclick="window.calculator.applyCitationValues(this)">
                        <div class="citation-header">
                            <div class="study-title">${study.title}</div>
                            <div class="confidence-badge confidence-${study.confidence}">${study.confidence} confidence</div>
                        </div>
                        <div class="study-authors">${study.authors}</div>
                        <div class="study-finding ${buttonType}">${study.finding}</div>
                        <div class="study-method">${study.method}</div>
                        <div class="citation-actions">
                            <button class="apply-values-btn" onclick="event.stopPropagation(); window.calculator.applyCitationValues(this.parentElement.parentElement);">
                                üìä Apply These Values
                            </button>
                            <a href="${study.link}" target="_blank" class="study-link" onclick="event.stopPropagation();">
                                üìÑ View Study
                            </a>
                        </div>
                    </div>
                `).join('');
                
                return `
                    <div class="research-content">
                        <h4>${data.title}</h4>
                        <div class="citation-instructions">
                            <small>üí° Click any study below to apply its values to the calculator</small>
                        </div>
                        ${studiesHtml}
                    </div>
                `;
            }
            
            setupCommunityCalculator() {
                const calculateBtn = document.getElementById('calculate-community-btn');
                if (calculateBtn) {
                    calculateBtn.addEventListener('click', () => {
                        this.calculateCommunityImpact();
                    });
                }
            }
            
            calculateCommunityImpact() {
                const populationInput = document.getElementById('community-population');
                const stateSelect = document.getElementById('state-select');
                const resultsDiv = document.getElementById('community-results');
                const detailsDiv = document.getElementById('community-impact-details');
                
                if (!populationInput || !stateSelect || !resultsDiv || !detailsDiv) return;
                
                const population = parseInt(populationInput.value);
                const state = stateSelect.value;
                
                if (!population || population < 1000) {
                    alert('Please enter a valid population (minimum 1,000)');
                    return;
                }
                
                const results = this.calculate();
                const nationalPopulation = 333000000;
                
                const perCapitaCost = results.total / nationalPopulation;
                const localTotalCost = perCapitaCost * population;
                const localDepression = Math.round((this.parameters.depression / nationalPopulation) * population);
                const localSuicides = Math.round(((this.parameters.suicides * this.parameters.attribution / 100) / nationalPopulation) * population * 15);
                
                detailsDiv.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div><strong>Total Economic Impact:</strong><br>${this.formatCurrency(localTotalCost)}</div>
                        <div><strong>Per Person Cost:</strong><br>${this.formatCurrency(perCapitaCost)}</div>
                        <div><strong>Estimated Depression Cases:</strong><br>${localDepression.toLocaleString()} people</div>
                        <div><strong>Estimated Deaths (15 years):</strong><br>${localSuicides.toLocaleString()} people</div>
                    </div>
                `;
                
                resultsDiv.classList.remove('hidden');
            }
            
            setupShareButtons() {
                const shareButtons = ['share-twitter', 'share-linkedin', 'share-facebook'];
                shareButtons.forEach(btnId => {
                    const btn = document.getElementById(btnId);
                    if (btn) {
                        btn.addEventListener('click', () => {
                            this.shareResults(btnId.replace('share-', ''));
                        });
                    }
                });
            }
            
            shareResults(platform) {
                const results = this.calculate();
                const totalCost = this.formatCurrency(results.total);
                
                const messages = {
                    twitter: `Social media's hidden cost to society: ${totalCost}. Calculate your community's impact: https://suffering.social`,
                    linkedin: `Research shows social media's total economic impact reaches ${totalCost}. Explore: https://suffering.social`,
                    facebook: `Social media's impact costs ${totalCost}. See the analysis: https://suffering.social`
                };
                
                const urls = {
                    twitter: `https://twitter.com/intent/tweet?text=${encodeURIComponent(messages.twitter)}`,
                    linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent('https://suffering.social')}`,
                    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://suffering.social')}`
                };
                
                window.open(urls[platform], '_blank', 'width=600,height=400');
                
                this.socialProofData.totalShares++;
                this.socialProofData.dailyShares++;
                this.updateSocialProofDisplays();
            }
            
            setupGDPComparisons() {
                const generateBtn = document.getElementById('generate-new-comparisons');
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => {
                        console.log('üé≤ Generate New Comparisons clicked');
                        this.updateGDPComparisons();
                        this.updateViralComparisons();
                    });
                    console.log('‚úÖ Generate New Comparisons button connected');
                } else {
                    console.error('‚ùå Generate New Comparisons button not found');
                }
                
                this.updateGDPComparisons();
                this.updateViralComparisons();
            }
            
            updateGDPComparisons() {
                if (!this.gdpComparisons || !Array.isArray(this.gdpComparisons) || this.gdpComparisons.length === 0) {
                    console.warn('‚ö†Ô∏è GDP comparisons not available, skipping update');
                    return;
                }
                
                const comparison = this.gdpComparisons[Math.floor(Math.random() * this.gdpComparisons.length)];
                const container = document.getElementById('dynamic-comparison-container');
                
                if (container && comparison) {
                    container.innerHTML = `
                        <span class="text-6xl mr-4">${comparison.emoji}</span>
                        <span>${comparison.text}</span>
                    `;
                }
            }
            
            updateViralComparisons() {
                const comparisonsDiv = document.getElementById('viral-comparisons-grid');
                if (!comparisonsDiv) return;
                
                if (!this.viralComparisons || !Array.isArray(this.viralComparisons) || this.viralComparisons.length === 0) {
                    console.warn('‚ö†Ô∏è Viral comparisons not available, skipping update');
                    return;
                }
                
                const shuffled = [...this.viralComparisons].sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 4);
                
                comparisonsDiv.innerHTML = selected.map(comparison => 
                    `<div class="p-3 bg-white/10 rounded-lg border border-white/20">${comparison}</div>`
                ).join('');
            }
            
            setupSocialProof() {
                this.updateSocialProofDisplays();
                this.generateActivityFeed();
                
                setInterval(() => {
                    this.generateActivityFeed();
                }, 30000);
            }
            
            updateSocialProofDisplays() {
                const elements = {
                    'total-calculations': this.socialProofData.totalCalculations.toLocaleString(),
                    'total-shares': this.socialProofData.totalShares.toLocaleString(),
                    'avg-result': `$${this.socialProofData.avgResult}T`,
                    'daily-calculations': `‚ÜóÔ∏è +${this.socialProofData.dailyCalculations} today`,
                    'daily-shares': `‚ÜóÔ∏è +${this.socialProofData.dailyShares} today`
                };
                
                Object.entries(elements).forEach(([id, value]) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value;
                });
            }
            
            generateActivityFeed() {
                const activities = [
                    'Someone in California calculated $2.1T impact',
                    'Shared on Twitter: "Mind-blowing research"',
                    'Someone in Texas calculated $2.8T impact',
                    'University researcher accessed methodology',
                    'Someone in New York calculated $1.9T impact'
                ];
                
                const feedDiv = document.getElementById('activity-feed');
                if (!feedDiv) return;
                
                const randomActivities = activities.sort(() => 0.5 - Math.random()).slice(0, 3);
                
                feedDiv.innerHTML = randomActivities.map(activity => 
                    `<div class="text-gray-600">‚Ä¢ ${activity}</div>`
                ).join('');
            }
            
            startSocialProofAnimations() {
                setInterval(() => {
                    if (Math.random() < 0.3) {
                        this.socialProofData.totalCalculations += Math.floor(Math.random() * 3) + 1;
                        this.socialProofData.dailyCalculations += Math.floor(Math.random() * 2) + 1;
                    }
                    
                    if (Math.random() < 0.2) {
                        this.socialProofData.totalShares += 1;
                        this.socialProofData.dailyShares += 1;
                    }
                    
                    this.updateSocialProofDisplays();
                }, 15000);
            }
            
            setupCausalModal() {
                const causalModal = document.getElementById('causal-modal');
                const causalClose = document.getElementById('causal-modal-close');
                
                if (causalClose && causalModal) {
                    causalClose.addEventListener('click', () => {
                        causalModal.classList.add('hidden');
                    });
                }
                
                if (causalModal) {
                    causalModal.addEventListener('click', (e) => {
                        if (e.target === causalModal) {
                            causalModal.classList.add('hidden');
                        }
                    });
                }
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && causalModal && !causalModal.classList.contains('hidden')) {
                        causalModal.classList.add('hidden');
                    }
                });
            }
            
            setupDistributionCharts() {
                // Wait a moment for DOM to be fully ready
                setTimeout(() => {
                    console.log('üé® Setting up distribution charts...');
                    
                    // Create simple distribution visualizations that span full width
                    const params = ['vsl', 'suicides', 'attribution', 'depression', 'yld', 'qol', 'healthcare', 'productivity', 'duration'];
                    
                    params.forEach(param => {
                        console.log(`üìä Creating distribution chart for ${param}...`);
                        this.createDistributionChart(param);
                    });
                    
                    this.updateDistributionInfo();
                    
                    // Force initial update of all distribution charts
                    params.forEach(param => {
                        this.updateDistributionChart(param);
                    });
                    
                    console.log('‚úÖ Distribution charts setup complete');
                }, 200);
            }
            
            createDistributionChart(paramName) {
                const svg = document.getElementById(`${paramName}-svg`);
                if (!svg) {
                    console.warn(`‚ö†Ô∏è SVG element ${paramName}-svg not found`);
                    return;
                }
                
                const container = svg.parentElement;
                const containerWidth = container.getBoundingClientRect().width || 400;
                
                const width = Math.max(300, containerWidth);
                const height = 100;
                
                svg.setAttribute('width', width);
                svg.setAttribute('height', height);
                svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
                svg.style.width = '100%';
                svg.style.height = '100px';
                svg.style.display = 'block';
                
                // Get theme colors for this parameter
                const themeColors = this.getThemeColors(paramName);
                
                // Create enhanced distribution with caching
                const points = this.generateCachedDistributionPoints(width, height, paramName);
                
                if (points.length === 0) {
                    console.warn(`‚ö†Ô∏è No distribution points generated for ${paramName}`);
                    return;
                }
                
                const pathData = this.createSimplePath(points, width, height);
                
                // Clear SVG and add gradient definitions
                svg.innerHTML = '';
                
                // Add gradient definition
                const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
                gradient.setAttribute('id', `gradient-${paramName}`);
                gradient.setAttribute('x1', '0%');
                gradient.setAttribute('y1', '0%');
                gradient.setAttribute('x2', '0%');
                gradient.setAttribute('y2', '100%');
                
                const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                stop1.setAttribute('offset', '0%');
                stop1.setAttribute('stop-color', themeColors.fill);
                stop1.setAttribute('stop-opacity', '0.15');
                
                const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                stop2.setAttribute('offset', '100%');
                stop2.setAttribute('stop-color', themeColors.fill);
                stop2.setAttribute('stop-opacity', '0.02');
                
                gradient.appendChild(stop1);
                gradient.appendChild(stop2);
                defs.appendChild(gradient);
                svg.appendChild(defs);
                
                // Create main path with themed colors
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', `url(#gradient-${paramName})`);
                path.setAttribute('stroke', themeColors.stroke);
                path.setAttribute('stroke-width', '1.5');
                path.setAttribute('opacity', '0');
                
                svg.appendChild(path);
                
                // Subtle fade-in animation
                if (typeof anime !== 'undefined') {
                    anime({
                        targets: path,
                        opacity: [0, 1],
                        duration: 200,
                        easing: 'easeOutQuart'
                    });
                }
                
                // Update current value indicator
                this.updateCurrentValueIndicator(paramName);
                
                // Add accessibility and interactivity
                this.addDistributionInteractivity(container, paramName);
                
                console.log(`${paramName} distribution chart initialized`);
            }
            
            // ENHANCED: Add interactive features to distributions
            addDistributionInteractivity(container, paramName) {
                // Add ARIA labels for accessibility
                container.setAttribute('role', 'img');
                container.setAttribute('aria-label', 
                    `Uncertainty distribution for ${paramName} showing range of likely values`);
                
                // Add hover tooltip if Tippy.js is available
                if (typeof tippy !== 'undefined') {
                    const config = {
                        'vsl': 'Value of Statistical Life - shows uncertainty in VSL estimates from research',
                        'suicides': 'Excess Suicides - shows range of estimated cases attributable to social media',
                        'attribution': 'Attribution Percentage - shows uncertainty in causal relationship strength',
                        'depression': 'Depression Cases - shows range of affected population estimates',
                        'yld': 'Years with Disability - shows typical duration of depression episodes',
                        'qol': 'Quality of Life Impact - shows severity of wellbeing reduction',
                        'healthcare': 'Healthcare Costs - shows range of annual medical expenses per case',
                        'productivity': 'Productivity Loss - shows economic impact per affected person',
                        'duration': 'Treatment Duration - shows typical length of care needed'
                    };
                    
                    tippy(container, {
                        content: `<div class="text-sm">
                            <strong>${paramName.toUpperCase()}</strong><br>
                            ${config[paramName] || 'Uncertainty visualization'}
                        </div>`,
                        allowHTML: true,
                        theme: 'light-border',
                        placement: 'top',
                        delay: [800, 100]
                    });
                }
                
                // Add subtle click to focus functionality
                container.addEventListener('click', () => {
                    const slider = document.getElementById(`${paramName}-slider`) || 
                                  document.querySelector(`#${paramName}-nouislider`);
                    if (slider) {
                        slider.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        // Subtle visual emphasis
                        if (typeof anime !== 'undefined') {
                            anime({
                                targets: slider,
                                scale: [1, 1.005, 1],
                                duration: 200,
                                easing: 'easeOutQuart'
                            });
                        }
                    }
                });
            }
            
            updateDistributionChart(paramName) {
                const svg = document.getElementById(`${paramName}-svg`);
                if (!svg) return;
                
                const container = svg.parentElement.parentElement; // Get distribution-viz container
                const containerWidth = container.getBoundingClientRect().width || 400;
                
                // Add loading state
                container.classList.add('updating');
                
                // Clear any existing timeout
                if (this.updateTimeouts[paramName]) {
                    clearTimeout(this.updateTimeouts[paramName]);
                }
                
                // Debounced update for smoother performance
                this.updateTimeouts[paramName] = setTimeout(() => {
                    const width = containerWidth;
                    const height = 100;
                    
                    console.log(`Updating ${paramName} distribution`);
                    
                    // Get theme colors and importance weighting
                    const themeColors = this.getThemeColors(paramName);
                    const importance = this.getVisualImportance(paramName);
                    const adjustedHeight = height * importance;
                    
                    // Generate cached points for performance
                    const points = this.generateCachedDistributionPoints(width, adjustedHeight, paramName);
                    if (points.length === 0) {
                        console.warn(`‚ö†Ô∏è No distribution points generated for ${paramName}`);
                        container.classList.remove('updating');
                        return;
                    }
                    
                    const pathData = this.createSimplePath(points, width, height);
                    
                    // Find existing path or create new one
                    let path = svg.querySelector('path');
                    if (!path) {
                        // Recreate the entire chart if missing
                        this.createDistributionChart(paramName);
                        container.classList.remove('updating');
                        return;
                    }
                    
                    // Subtle transition to new curve
                    if (typeof anime !== 'undefined') {
                        anime({
                            targets: path,
                            opacity: [1, 0.6, 1],
                            duration: 150,
                            easing: 'easeInOutQuart',
                            complete: () => {
                                path.setAttribute('d', pathData);
                                path.setAttribute('fill', `url(#gradient-${paramName})`);
                                path.setAttribute('stroke', themeColors.stroke);
                                container.classList.remove('updating');
                            }
                        });
                    } else {
                        path.setAttribute('d', pathData);
                        container.classList.remove('updating');
                    }
                    
                    // Update current value indicator
                    this.updateCurrentValueIndicator(paramName);
                    
                    console.log(`${paramName} distribution refreshed`);
                }, 50); // Subtle debounce delay
            }
            
            getExpandedDistributionRange(paramName, currentValue) {
                // Create wider, more natural parameter ranges for distribution visualization
                // Current value should fall within a reasonable part of the distribution, not at the extremes
                const expansionConfigs = {
                    'vsl': {
                        minExpansion: 0.4, maxExpansion: 2.2,  // $3M to $30M range
                        distributionCenter: 0.45  // Current value at ~45% of range
                    },
                    'suicides': {
                        minExpansion: 0.3, maxExpansion: 2.5,  // 30K to 750K range  
                        distributionCenter: 0.35
                    },
                    'attribution': {
                        minExpansion: 0.2, maxExpansion: 3.0,  // 1% to 90% range
                        distributionCenter: 0.3
                    },
                    'depression': {
                        minExpansion: 0.5, maxExpansion: 2.0,  // 1.5M to 30M range
                        distributionCenter: 0.4
                    },
                    'yld': {
                        minExpansion: 0.5, maxExpansion: 2.5,  // 2 to 20 years range
                        distributionCenter: 0.4
                    },
                    'qol': {
                        minExpansion: 0.4, maxExpansion: 2.0,  // 12% to 80% range
                        distributionCenter: 0.5
                    },
                    'healthcare': {
                        minExpansion: 0.3, maxExpansion: 3.0,  // $2K to $60K range
                        distributionCenter: 0.35
                    },
                    'productivity': {
                        minExpansion: 0.5, maxExpansion: 2.5,  // $3K to $25K range
                        distributionCenter: 0.4
                    },
                    'duration': {
                        minExpansion: 0.3, maxExpansion: 2.8,  // 1 to 17 years range
                        distributionCenter: 0.35
                    }
                };
                
                const config = expansionConfigs[paramName] || { minExpansion: 0.5, maxExpansion: 2.0, distributionCenter: 0.5 };
                
                // Calculate expanded range where current value is positioned at distributionCenter
                const rangeBelow = currentValue / config.distributionCenter * config.minExpansion;
                const rangeAbove = currentValue / (1 - config.distributionCenter) * (config.maxExpansion - 1);
                
                const min = Math.max(0, currentValue - rangeBelow);
                const max = currentValue + rangeAbove;
                
                return { min, max };
            }
            
            generateDynamicDistributionPoints(width, height, paramName) {
                const points = [];
                const numPoints = 120; // More points for smoother curves
                const currentValue = this.parameters[paramName];
                
                // Get slider config for actual min/max ranges
                const sliderConfigs = {
                    'vsl': { min: 8, max: 20 },
                    'suicides': { min: 100000, max: 300000 },
                    'attribution': { min: 5, max: 30 },
                    'depression': { min: 3000000, max: 15000000 },
                    'yld': { min: 4, max: 8 },
                    'qol': { min: 30, max: 40 },
                    'healthcare': { min: 6500, max: 20000 },
                    'productivity': { min: 6000, max: 10000 },
                    'duration': { min: 3, max: 6 }
                };
                
                const config = sliderConfigs[paramName];
                if (!config) {
                    console.error(`No slider config found for ${paramName}`);
                    return [];
                }
                
                const min = config.min;
                const max = config.max;
                const range = max - min;
                
                // Calculate current value position on slider (0 to 1)
                const currentPosition = Math.max(0.01, Math.min(0.99, (currentValue - min) / range));
                
                console.log(`üé® FIXED DISTRIBUTION: ${paramName} = ${currentValue}, position = ${currentPosition.toFixed(3)}, range = [${min}, ${max}]`);
                
                // SIMPLIFIED: Just two distribution types for visual clarity
                const distributions = {
                    vsl: 'normal',           // Clean bell curve for VSL
                    suicides: 'skewed',      // Right-skewed for count data
                    attribution: 'normal',   // Clean bell curve for percentages
                    depression: 'skewed',    // Right-skewed for population counts
                    yld: 'normal',          // Clean bell curve for duration
                    qol: 'normal',          // Clean bell curve for percentages  
                    healthcare: 'skewed',   // Right-skewed for cost data
                    productivity: 'skewed', // Right-skewed for cost data
                    duration: 'normal'      // Clean bell curve for duration
                };
                
                const distType = distributions[paramName] || 'normal';
                const maxHeight = height * 0.9;
                
                // SIMPLIFIED: Single spread factor for clean, consistent curves
                const spreadFactor = 0.12;
                
                // SIMPLIFIED: Clean, continuous distributions extending beyond visible range
                const densities = [];
                let maxDensity = 0;
                
                for (let i = 0; i <= numPoints; i++) {
                    const position = i / numPoints; // 0 to 1 across visible range
                    let density = 0;
                    
                    // Simple offset from current value position
                    const offset = (position - currentPosition) / spreadFactor;
                    
                    switch (distType) {
                        case 'normal':
                            // Clean symmetric bell curve
                            density = Math.exp(-0.5 * offset * offset);
                            break;
                            
                        case 'skewed':
                            // Simple right-skewed curve - gradual rise, sharp drop
                            if (offset < 0) {
                                // Left side: gradual rise
                                density = Math.exp(-0.3 * offset * offset);
                            } else {
                                // Right side: faster decay
                                density = Math.exp(-1.2 * offset * offset);
                            }
                            break;
                            
                        default:
                            // Default to normal
                            density = Math.exp(-0.5 * offset * offset);
                    }
                    
                    // Only check for valid numbers (no artificial cutoffs)
                    if (!isFinite(density) || isNaN(density) || density < 0) {
                        density = 0;
                    }
                    
                    densities.push(density);
                    maxDensity = Math.max(maxDensity, density);
                }
                
                // Second pass: normalize and create points
                for (let i = 0; i <= numPoints; i++) {
                    const x = (i / numPoints) * width;
                    let normalizedDensity = 0;
                    
                    if (maxDensity > 0) {
                        normalizedDensity = densities[i] / maxDensity;
                    }
                    
                    // Enhance curve for better visibility
                    normalizedDensity = Math.pow(normalizedDensity, 0.6);
                    
                    const y = height - (maxHeight * normalizedDensity);
                    
                    points.push({ 
                        x: Math.max(0, Math.min(width, x)), 
                        y: Math.max(0, Math.min(height, y)) 
                    });
                }
                
                console.log(`‚úÖ FIXED: Generated ${points.length} points for ${paramName} (${distType}) with proper peak positioning`);
                return points;
            }
            
            // REMOVED: Complex helper functions no longer needed with simplified approach
            
            createSimplePath(points, width, height) {
                let path = `M 0 ${height}`;
                
                points.forEach((point, index) => {
                    if (index === 0) {
                        path += ` L ${point.x} ${point.y}`;
                    } else {
                        path += ` L ${point.x} ${point.y}`;
                    }
                });
                
                path += ` L ${width} ${height} Z`;
                return path;
            }
            
            updateCurrentValueIndicatorWithExpandedRange(paramName) {
                const currentValueDiv = document.getElementById(`${paramName}-current`);
                if (!currentValueDiv) {
                    console.warn(`‚ö†Ô∏è Red line indicator ${paramName}-current not found`);
                    return;
                }
                
                const currentValue = this.parameters[paramName];
                
                // Use actual slider ranges, not expanded ranges
                const sliderConfigs = {
                    'vsl': { min: 8, max: 20 },
                    'suicides': { min: 100000, max: 300000 },
                    'attribution': { min: 5, max: 30 },
                    'depression': { min: 3000000, max: 15000000 },
                    'yld': { min: 4, max: 8 },
                    'qol': { min: 30, max: 40 },
                    'healthcare': { min: 6500, max: 20000 },
                    'productivity': { min: 6000, max: 10000 },
                    'duration': { min: 3, max: 6 }
                };
                
                const config = sliderConfigs[paramName];
                if (!config) {
                    console.error(`No slider config found for ${paramName}`);
                    return;
                }
                
                // Position the red line based on actual slider range
                const percentage = ((currentValue - config.min) / (config.max - config.min)) * 100;
                const clampedPercentage = Math.max(0, Math.min(100, percentage));
                
                currentValueDiv.style.left = `${clampedPercentage}%`;
                
                console.log(`üî¥ Red line for ${paramName}: value=${currentValue}, position=${clampedPercentage.toFixed(1)}%`);
            }
            
            updateCurrentValueIndicator(paramName) {
                // Fallback method for backward compatibility
                this.updateCurrentValueIndicatorWithExpandedRange(paramName);
            }
            
            updateDistributionInfo() {
                // FIXED: Dynamic confidence intervals that update based on current parameter values
                console.log('üîÑ DYNAMIC CI UPDATE: Calculating confidence intervals for current parameter values...');
                
                // REFINED: Professional distribution descriptions for research context
                const distributionConfigs = {
                    'vsl': { 
                        type: 'normal', 
                        name: 'Uncertainty Range',
                        uncertaintyFactor: 0.25,
                        researchRange: '$8M-$20M',
                        importance: 1.1,
                        theme: 'mortality'
                    },
                    'suicides': { 
                        type: 'skewed', 
                        name: 'Right-Skewed Distribution',
                        uncertaintyFactor: 0.30,
                        researchRange: '85K-375K',
                        importance: 1.2,
                        theme: 'mortality'
                    },
                    'attribution': { 
                        type: 'normal', 
                        name: 'Uncertainty Range',
                        uncertaintyFactor: 0.35,
                        researchRange: '12%-42%',
                        importance: 1.1,
                        theme: 'mortality'
                    },
                    'depression': { 
                        type: 'skewed', 
                        name: 'Right-Skewed Distribution',
                        uncertaintyFactor: 0.28,
                        researchRange: '3M-15M',
                        importance: 1.2,
                        theme: 'mental-health'
                    },
                    'yld': { 
                        type: 'normal', 
                        name: 'Uncertainty Range',
                        uncertaintyFactor: 0.20,
                        researchRange: '4-8 years',
                        importance: 0.9,
                        theme: 'mental-health'
                    },
                    'qol': { 
                        type: 'normal', 
                        name: 'Uncertainty Range',
                        uncertaintyFactor: 0.15,
                        researchRange: '30%-40%',
                        importance: 0.9,
                        theme: 'mental-health'
                    },
                    'healthcare': { 
                        type: 'skewed', 
                        name: 'Right-Skewed Distribution',
                        uncertaintyFactor: 0.35,
                        researchRange: '$6.5K-$20K',
                        importance: 1.0,
                        theme: 'productivity'
                    },
                    'productivity': { 
                        type: 'skewed', 
                        name: 'Right-Skewed Distribution',
                        uncertaintyFactor: 0.25,
                        researchRange: '$6K-$10K',
                        importance: 1.0,
                        theme: 'productivity'
                    },
                    'duration': { 
                        type: 'normal', 
                        name: 'Uncertainty Range',
                        uncertaintyFactor: 0.22,
                        researchRange: '3-6 years',
                        importance: 0.9,
                        theme: 'productivity'
                    }
                };
                
                // Format current values for display
                const formatters = {
                    'vsl': (v) => `$${parseFloat(v).toFixed(1)}M`,
                    'suicides': (v) => `${Math.round(v/1000)}K`,
                    'attribution': (v) => `${Math.round(v)}%`,
                    'depression': (v) => `${(v/1000000).toFixed(1)}M`,
                    'yld': (v) => `${parseFloat(v).toFixed(1)} years`,
                    'qol': (v) => `${Math.round(v)}%`,
                    'healthcare': (v) => `$${(v/1000).toFixed(1)}K`,
                    'productivity': (v) => `$${(v/1000).toFixed(1)}K`,
                    'duration': (v) => `${parseFloat(v).toFixed(1)} years`
                };
                
                const updates = {};
                
                Object.keys(distributionConfigs).forEach(param => {
                    const config = distributionConfigs[param];
                    const currentValue = this.parameters[param];
                    const formattedCurrent = formatters[param](currentValue);
                    
                    // Calculate DYNAMIC 95% confidence intervals based on current value
                    const ci95 = this.calculateDynamicCI(currentValue, config.type, config.uncertaintyFactor, formatters[param]);
                    
                    // Calculate median for display (different from current value for skewed distributions)
                    const median = this.calculateMedian(currentValue, config.type, config.uncertaintyFactor);
                    const formattedMedian = formatters[param](median);
                    
                    updates[`${param}-info`] = `${config.name} | Current: ${formattedCurrent} | Typical: ${formattedMedian} | Research: ${config.researchRange} | Likely Range: ${ci95.lower} - ${ci95.upper}`;
                    
                    console.log(`üìä ${param}: Current=${currentValue}, Median=${median.toFixed(2)}, CI=[${ci95.lower}, ${ci95.upper}]`);
                });
                
                Object.entries(updates).forEach(([id, text]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        // Enhanced display with screen reader support
                        element.innerHTML = `
                            <span class="distribution-summary">${text}</span>
                            <span class="sr-only">
                                Distribution showing uncertainty range for this parameter
                            </span>
                        `;
                    }
                });
                
                // Update current value indicators and refresh distribution charts
                ['vsl', 'suicides', 'attribution', 'depression', 'yld', 'qol', 'healthcare', 'productivity', 'duration'].forEach(param => {
                    this.updateCurrentValueIndicatorWithExpandedRange(param);
                    // Also refresh the distribution curve to match new parameter value
                    this.updateDistributionChart(param);
                });
                
                console.log('‚úÖ DYNAMIC CI: Distribution info updated with dynamic confidence intervals');
            }
            
            // SIMPLIFIED: Clean confidence interval calculation
            calculateDynamicCI(currentValue, distributionType, uncertaintyFactor, formatter) {
                let lower, upper;
                
                const stdDev = currentValue * uncertaintyFactor;
                
                if (distributionType === 'skewed') {
                    // For skewed distributions: asymmetric intervals (tighter on left, wider on right)
                    lower = currentValue - 1.5 * stdDev;
                    upper = currentValue + 2.5 * stdDev;
                } else {
                    // For normal distributions: symmetric intervals
                    lower = currentValue - 1.96 * stdDev;
                    upper = currentValue + 1.96 * stdDev;
                }
                
                // Ensure non-negative values where appropriate
                lower = Math.max(0, lower);
                upper = Math.max(lower, upper);
                
                return {
                    lower: formatter(lower),
                    upper: formatter(upper)
                };
            }
            
            // SIMPLIFIED: Clean median calculation
            calculateMedian(currentValue, distributionType, uncertaintyFactor) {
                if (distributionType === 'skewed') {
                    // For skewed distributions: median slightly below current value
                    return currentValue * 0.95;
                } else {
                    // For normal distributions: median = current value
                    return currentValue;
                }
            }
            
            // ENHANCED: Get theme colors for parameter groups
            getThemeColors(paramName) {
                const themeMap = {
                    'vsl': { fill: '#dc2626', stroke: '#b91c1c' },
                    'suicides': { fill: '#dc2626', stroke: '#b91c1c' },
                    'attribution': { fill: '#dc2626', stroke: '#b91c1c' },
                    'depression': { fill: '#8b5cf6', stroke: '#7c3aed' },
                    'yld': { fill: '#8b5cf6', stroke: '#7c3aed' },
                    'qol': { fill: '#8b5cf6', stroke: '#7c3aed' },
                    'healthcare': { fill: '#16a34a', stroke: '#15803d' },
                    'productivity': { fill: '#16a34a', stroke: '#15803d' },
                    'duration': { fill: '#16a34a', stroke: '#15803d' }
                };
                
                return themeMap[paramName] || { fill: '#3b82f6', stroke: '#2563eb' };
            }
            
            // ENHANCED: Cached distribution point generation for performance
            generateCachedDistributionPoints(width, height, paramName) {
                const currentValue = this.parameters[paramName];
                const cacheKey = `${paramName}-${width}-${height}-${currentValue.toFixed(3)}`;
                
                // Return cached result if available
                if (this.curveCache[cacheKey]) {
                    return this.curveCache[cacheKey];
                }
                
                // Generate new points with enhanced smoothness
                const points = this.generateDynamicDistributionPoints(width, height, paramName);
                
                // Cache the result (limit cache size)
                if (Object.keys(this.curveCache).length > 50) {
                    const oldestKey = Object.keys(this.curveCache)[0];
                    delete this.curveCache[oldestKey];
                }
                
                this.curveCache[cacheKey] = points;
                return points;
            }
            
            // ENHANCED: Visual importance weighting for different parameters
            getVisualImportance(paramName) {
                const importance = {
                    'depression': 1.2,  // Most important - taller curves
                    'suicides': 1.2,
                    'vsl': 1.1,
                    'attribution': 1.1,
                    'healthcare': 1.0,  // Standard height
                    'productivity': 1.0,
                    'duration': 0.9,    // Less important - shorter curves
                    'yld': 0.9,
                    'qol': 0.9
                };
                return importance[paramName] || 1.0;
            }
            
            updateDisplay(param, value) {
                const display = document.getElementById(`${param}-value`);
                if (!display) return;
                
                const formatters = {
                    vsl: v => `$${v}M`,
                    suicides: v => `${Math.round(v/1000)}K`,
                    attribution: v => `${v}%`,
                    depression: v => `${(v/1000000).toFixed(1)}M`,
                    yld: v => `${parseFloat(v).toFixed(1)} years`,
                    qol: v => `${v}%`,
                    healthcare: v => `$${(v/1000).toFixed(0)}K`,
                    productivity: v => `$${(v/1000).toFixed(0)}K`,
                    duration: v => `${parseFloat(v).toFixed(1)} years`
                };
                
                display.textContent = formatters[param] ? formatters[param](value) : value;
            }
            
            calculate() {
                const mortality = (this.parameters.suicides * this.parameters.attribution / 100) * this.parameters.vsl * 1000000;
                const mental = this.parameters.depression * this.parameters.yld * (this.parameters.qol / 100) * (this.parameters.vsl * 1000000 / 75);
                const productivity = this.parameters.depression * (this.parameters.healthcare + this.parameters.productivity) * this.parameters.duration;
                
                return {
                    mortality,
                    mental,
                    productivity,
                    total: mortality + mental + productivity
                };
            }
            
            updateAllDisplays() {
                const results = this.calculate();
                const oldResults = this.lastResults || {};
                this.lastResults = results;
                
                // Professional animated updates
                this.animateValueUpdate('total-cost', this.formatCurrency(results.total), results.total, oldResults.total);
                this.animateValueUpdate('total-amount', Math.round(results.total).toLocaleString(), results.total, oldResults.total);
                
                // Update hero section total with emphasis animation
                const heroTotalEl = document.getElementById('hero-total-cost');
                if (heroTotalEl) {
                    this.animateValueUpdate('hero-total-cost', this.formatCurrency(results.total), results.total, oldResults.total);
                }
                
                // Update GDP percentage with subtle animation
                const gdpPercentage = ((results.total / 24000000000000) * 100).toFixed(1);
                this.animateValueUpdate('gdp-percentage', `${gdpPercentage}%`, parseFloat(gdpPercentage), oldResults.gdpPercentage || 0);
                
                // Update formula results with staggered animations - FIXED FORMULA UPDATES
                setTimeout(() => {
                    const mortalityFormula = `${Math.round(this.parameters.suicides/1000)}K √ó ${this.parameters.attribution}% √ó $${this.parameters.vsl}M = ${this.formatCurrency(results.mortality)}`;
                    this.animateValueUpdate('mortality-result', mortalityFormula, results.mortality, oldResults.mortality);
                    
                    // Also update any other mortality formula displays
                    const mortalityFormulaEl = document.getElementById('mortality-formula-result');
                    if (mortalityFormulaEl) {
                        mortalityFormulaEl.textContent = mortalityFormula;
                    }
                }, 100);
                
                setTimeout(() => {
                    const mentalFormula = `${(this.parameters.depression/1000000).toFixed(1)}M √ó ${this.parameters.yld} √ó ${this.parameters.qol}% √ó $${Math.round(this.parameters.vsl * 1000000 / 75 / 1000)}K = ${this.formatCurrency(results.mental)}`;
                    this.animateValueUpdate('mental-result', mentalFormula, results.mental, oldResults.mental);
                    
                    // Also update any other mental health formula displays
                    const mentalFormulaEl = document.getElementById('mental-formula-result');
                    if (mentalFormulaEl) {
                        mentalFormulaEl.textContent = mentalFormula;
                    }
                }, 200);
                
                setTimeout(() => {
                    const productivityFormula = `${(this.parameters.depression/1000000).toFixed(1)}M √ó ($${Math.round(this.parameters.healthcare/1000)}K + $${Math.round(this.parameters.productivity/1000)}K) √ó ${this.parameters.duration} = ${this.formatCurrency(results.productivity)}`;
                    this.animateValueUpdate('healthcare-result', productivityFormula, results.productivity, oldResults.productivity);
                    
                    // Also update any other productivity formula displays
                    const productivityFormulaEl = document.getElementById('productivity-formula-result');
                    if (productivityFormulaEl) {
                        productivityFormulaEl.textContent = productivityFormula;
                    }
                }, 300);
                
                // Update final equation with dramatic animation for major changes
                const finalEq = document.getElementById('final-equation');
                if (finalEq) {
                    setTimeout(() => {
                        const newText = `Total Cost = ${this.formatCurrency(results.mortality)} + ${this.formatCurrency(results.mental)} + ${this.formatCurrency(results.productivity)} = ${this.formatCurrency(results.total)}`;
                        this.animateValueUpdate('final-equation', newText, results.total, oldResults.total);
                    }, 400);
                }
                
                // Animate chart updates
                this.updateChartsWithAnimation(results);
                
                // Force all distribution charts to refresh with new values
                this.refreshAllDistributionCharts();
                
                // Update social proof with subtle animation
                this.socialProofData.avgResult = (results.total / 1000000000000).toFixed(1);
                const avgEl = document.getElementById('avg-result');
                if (avgEl) {
                    setTimeout(() => {
                        this.animateValueUpdate('avg-result', `$${this.socialProofData.avgResult}T`, 
                            parseFloat(this.socialProofData.avgResult), oldResults.avgResult || 0);
                    }, 500);
                }
                
                // Store for next comparison
                oldResults.gdpPercentage = parseFloat(gdpPercentage);
                oldResults.avgResult = parseFloat(this.socialProofData.avgResult);
            }
            
            animateValueUpdate(elementId, newText, newValue, oldValue) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                // Update the text
                element.textContent = newText;
                
                // Add professional animation if values changed significantly
                if (window.animationController && Math.abs(newValue - (oldValue || 0)) > 0) {
                    window.animationController.animateValueChange(element, newValue, oldValue || 0);
                }
            }
            
            updateChartsWithAnimation(results) {
                // Show loading state
                const timelineChart = document.getElementById('timeline-chart');
                const pieChart = document.getElementById('pie-chart');
                
                if (window.animationController) {
                    if (timelineChart) window.animationController.showLoadingState(timelineChart);
                    if (pieChart) window.animationController.showLoadingState(pieChart);
                }
                
                // Update charts
                setTimeout(() => {
                    this.updateCharts(results);
                    
                    // Hide loading state with animation
                    if (window.animationController) {
                        if (timelineChart) window.animationController.hideLoadingState(timelineChart);
                        if (pieChart) window.animationController.hideLoadingState(pieChart);
                    }
                }, 300);
            }
            
            formatCurrency(amount) {
                if (amount >= 1000000000000) {
                    return `$${(amount / 1000000000000).toFixed(2)}T`;
                } else if (amount >= 1000000000) {
                    return `$${(amount / 1000000000).toFixed(1)}B`;
                } else if (amount >= 1000000) {
                    return `$${(amount / 1000000).toFixed(1)}M`;
                } else {
                    return `$${amount.toFixed(0)}`;
                }
            }
            
            setupCharts() {
                // Timeline Chart with 4 component lines
                const timelineCtx = document.getElementById('timeline-chart');
                if (timelineCtx && typeof Chart !== 'undefined') {
                    this.charts.timeline = new Chart(timelineCtx, {
                        type: 'line',
                        data: {
                            labels: ['2009', '2012', '2015', '2018', '2021', '2024'],
                            datasets: [
                                {
                                    label: '‚ò†Ô∏è Death Costs',
                                    data: [0, 27, 87, 166, 271, 271],
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    fill: false
                                },
                                {
                                    label: 'üòû Disability Costs',
                                    data: [0, 115, 371, 706, 1152, 1920],
                                    borderColor: '#8b5cf6',
                                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    fill: false
                                },
                                {
                                    label: 'üí∏ Productivity Costs',
                                    data: [0, 18, 58, 111, 181, 293],
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 2,
                                    fill: false
                                },
                                {
                                    label: 'Total Cost',
                                    data: [0, 160, 516, 983, 1604, 2484],
                                    borderColor: '#1f2937',
                                    backgroundColor: 'rgba(31, 41, 55, 0.1)',
                                    tension: 0.4,
                                    borderWidth: 3,
                                    borderDash: [5, 5],
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    display: true,
                                    position: 'bottom',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 10,
                                        font: { size: 11 }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value + 'B';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Pie Chart
                const pieCtx = document.getElementById('pie-chart');
                if (pieCtx && typeof Chart !== 'undefined') {
                    this.charts.pie = new Chart(pieCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['‚ò†Ô∏è Death', 'üòû Disability', 'üí∏ Lost Productivity'],
                            datasets: [{
                                data: [271, 1920, 293],
                                backgroundColor: ['#ef4444', '#8b5cf6', '#10b981'],
                                borderWidth: 2,
                                borderColor: '#ffffff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    position: 'bottom',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 15
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            updateCharts(results) {
                // Update pie chart
                if (this.charts.pie) {
                    this.charts.pie.data.datasets[0].data = [
                        results.mortality / 1000000000,
                        results.mental / 1000000000,
                        results.productivity / 1000000000
                    ];
                    this.charts.pie.update();
                }
                
                // Update timeline chart with dynamic progression
                if (this.charts.timeline) {
                    const progressionFactors = [0, 0.06, 0.18, 0.35, 0.65, 1.0]; // 2009-2024 adoption curve
                    
                    const mortalityProgression = progressionFactors.map(factor => 
                        Math.round((results.mortality / 1000000000) * factor)
                    );
                    
                    const mentalProgression = progressionFactors.map(factor => 
                        Math.round((results.mental / 1000000000) * factor)
                    );
                    
                    const productivityProgression = progressionFactors.map(factor => 
                        Math.round((results.productivity / 1000000000) * factor)
                    );
                    
                    const totalProgression = progressionFactors.map((factor, index) => 
                        mortalityProgression[index] + mentalProgression[index] + productivityProgression[index]
                    );
                    
                    this.charts.timeline.data.datasets[0].data = mortalityProgression;
                    this.charts.timeline.data.datasets[1].data = mentalProgression;
                    this.charts.timeline.data.datasets[2].data = productivityProgression;
                    this.charts.timeline.data.datasets[3].data = totalProgression;
                    
                    this.charts.timeline.update();
                }
            }
            
            startRunningCounter() {
                setInterval(() => {
                    const results = this.calculate();
                    const secondsSinceStart = (Date.now() - this.startTime) / 1000;
                    const costPerSecond = results.total / (15 * 365 * 24 * 60 * 60);
                    const runningCost = costPerSecond * secondsSinceStart;
                    
                    const runningTotalEl = document.getElementById('running-total');
                    const headerTotalEl = document.getElementById('total-amount');
                    
                    if (runningTotalEl) {
                        runningTotalEl.textContent = this.formatCurrency(runningCost);
                    }
                    
                    if (headerTotalEl) {
                        const newTotal = results.total + runningCost;
                        headerTotalEl.textContent = Math.round(newTotal).toLocaleString();
                    }
                }, 100);
            }
        }
        
        // Professional Performance Monitoring System
        class PerformanceMonitor {
            constructor() {
                this.metrics = {
                    fcp: null,
                    lcp: null,
                    cls: null,
                    fid: null,
                    ttfb: null
                };
                this.isWebVitalsLoaded = false;
                this.performanceDisplay = null;
                this.initializeMonitoring();
            }
            
            initializeMonitoring() {
                // Check if Web Vitals is loaded
                if (typeof webVitals !== 'undefined') {
                    this.isWebVitalsLoaded = true;
                    this.setupWebVitals();
                } else {
                    setTimeout(() => this.initializeMonitoring(), 100);
                }
            }
            
            setupWebVitals() {
                // First Contentful Paint
                webVitals.getFCP((metric) => {
                    this.metrics.fcp = metric.value;
                    this.updateDisplay('fcp', metric.value, 'ms');
                    this.logMetric('FCP', metric.value, 'ms');
                });
                
                // Largest Contentful Paint
                webVitals.getLCP((metric) => {
                    this.metrics.lcp = metric.value;
                    this.updateDisplay('lcp', metric.value, 'ms');
                    this.logMetric('LCP', metric.value, 'ms');
                });
                
                // Cumulative Layout Shift
                webVitals.getCLS((metric) => {
                    this.metrics.cls = metric.value;
                    this.updateDisplay('cls', metric.value.toFixed(3), '');
                    this.logMetric('CLS', metric.value.toFixed(3), '');
                });
                
                // First Input Delay
                webVitals.getFID((metric) => {
                    this.metrics.fid = metric.value;
                    this.updateDisplay('fid', metric.value, 'ms');
                    this.logMetric('FID', metric.value, 'ms');
                });
                
                // Time to First Byte
                webVitals.getTTFB((metric) => {
                    this.metrics.ttfb = metric.value;
                    this.logMetric('TTFB', metric.value, 'ms');
                });
                
                console.log('‚úÖ Web Vitals performance monitoring active');
                
                // Create performance summary after initial metrics
                setTimeout(() => {
                    this.createPerformanceSummary();
                }, 3000);
            }
            
            updateDisplay(metricName, value, unit) {
                const element = document.getElementById(`${metricName}-metric`);
                if (element) {
                    element.textContent = `${value}${unit}`;
                    
                    // Color code based on performance thresholds
                    element.className = this.getPerformanceClass(metricName, value);
                    
                    // Animate the update
                    if (window.animationController) {
                        window.animationController.animate({
                            targets: element,
                            scale: [1, 1.1, 1],
                            duration: 300,
                            easing: 'easeOutQuad'
                        });
                    }
                }
            }
            
            getPerformanceClass(metricName, value) {
                const thresholds = {
                    fcp: { good: 1800, poor: 3000 },
                    lcp: { good: 2500, poor: 4000 },
                    cls: { good: 0.1, poor: 0.25 },
                    fid: { good: 100, poor: 300 }
                };
                
                const threshold = thresholds[metricName];
                if (!threshold) return '';
                
                if (value <= threshold.good) return 'performance-good';
                if (value <= threshold.poor) return 'performance-needs-improvement';
                return 'performance-poor';
            }
            
            logMetric(name, value, unit) {
                const performance = value <= this.getGoodThreshold(name) ? 'üü¢' : 
                                  value <= this.getPoorThreshold(name) ? 'üü°' : 'üî¥';
                console.log(`üìä ${performance} ${name}: ${value}${unit}`);
            }
            
            getGoodThreshold(metricName) {
                const thresholds = { FCP: 1800, LCP: 2500, CLS: 0.1, FID: 100, TTFB: 800 };
                return thresholds[metricName] || 0;
            }
            
            getPoorThreshold(metricName) {
                const thresholds = { FCP: 3000, LCP: 4000, CLS: 0.25, FID: 300, TTFB: 1800 };
                return thresholds[metricName] || Infinity;
            }
            
            createPerformanceSummary() {
                const scores = this.calculatePerformanceScore();
                
                console.log(`üìä Performance Summary:`);
                console.log(`   Overall Score: ${scores.overall}/100`);
                console.log(`   Speed Index: ${scores.speed}/100`);
                console.log(`   Stability: ${scores.stability}/100`);
                
                // Add to analytics if available
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'performance_metrics', {
                        fcp: this.metrics.fcp,
                        lcp: this.metrics.lcp,
                        cls: this.metrics.cls,
                        fid: this.metrics.fid,
                        overall_score: scores.overall
                    });
                }
            }
            
            calculatePerformanceScore() {
                let speedScore = 100;
                let stabilityScore = 100;
                
                // Speed scoring
                if (this.metrics.fcp > 3000) speedScore -= 20;
                else if (this.metrics.fcp > 1800) speedScore -= 10;
                
                if (this.metrics.lcp > 4000) speedScore -= 30;
                else if (this.metrics.lcp > 2500) speedScore -= 15;
                
                if (this.metrics.fid > 300) speedScore -= 20;
                else if (this.metrics.fid > 100) speedScore -= 10;
                
                // Stability scoring
                if (this.metrics.cls > 0.25) stabilityScore -= 40;
                else if (this.metrics.cls > 0.1) stabilityScore -= 20;
                
                const overall = Math.round((speedScore + stabilityScore) / 2);
                
                return {
                    overall: Math.max(0, overall),
                    speed: Math.max(0, speedScore),
                    stability: Math.max(0, stabilityScore)
                };
            }
            
            toggleDisplay() {
                const display = document.getElementById('performance-metrics');
                if (display) {
                    display.classList.toggle('show');
                    
                    // Animate toggle
                    if (window.animationController) {
                        window.animationController.animate({
                            targets: display,
                            opacity: display.classList.contains('show') ? [0, 1] : [1, 0],
                            translateX: display.classList.contains('show') ? [-20, 0] : [0, -20],
                            duration: 300,
                            easing: 'easeOutQuad'
                        });
                    }
                }
            }
            
            // Real-time monitoring
            startRealtimeMonitoring() {
                // Monitor long tasks
                if ('PerformanceObserver' in window) {
                    const longTaskObserver = new PerformanceObserver((list) => {
                        for (const entry of list.getEntries()) {
                            if (entry.duration > 100) { // Increased threshold to reduce spam
                                console.warn(`‚ö†Ô∏è Long task detected: ${entry.duration.toFixed(1)}ms`);
                            }
                        }
                    });
                    
                    try {
                        longTaskObserver.observe({ entryTypes: ['longtask'] });
                    } catch (e) {
                        console.log('Long task monitoring not supported');
                    }
                }
                
                // Monitor memory usage (if available) - reduced frequency
                if ('memory' in performance) {
                    setInterval(() => {
                        const memInfo = performance.memory;
                        const usedMB = Math.round(memInfo.usedJSHeapSize / 1048576);
                        const totalMB = Math.round(memInfo.totalJSHeapSize / 1048576);
                        
                        if (usedMB > 80) { // Increased threshold to reduce spam
                            console.warn(`‚ö†Ô∏è High memory usage: ${usedMB}MB / ${totalMB}MB`);
                        }
                    }, 30000); // Reduced to every 30 seconds
                }
            }
        }
        
        // Smooth scroll to calculator function
        function smoothScrollToCalculator() {
            const calculatorStart = document.getElementById('calculator-start');
            if (calculatorStart) {
                calculatorStart.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Track performance of smooth scroll
                if (window.performanceMonitor) {
                    const startTime = performance.now();
                    setTimeout(() => {
                        const scrollTime = performance.now() - startTime;
                        console.log(`üìä Smooth scroll completed in ${scrollTime.toFixed(1)}ms`);
                    }, 1000);
                }
            }
        }
        
        // Professional Animation System using Anime.js
        class AnimationController {
            constructor() {
                this.isAnimeLoaded = false;
                this.animationQueue = [];
                this.checkAnimeJS();
            }
            
            checkAnimeJS() {
                if (typeof anime !== 'undefined') {
                    this.isAnimeLoaded = true;
                    this.processQueue();
                    console.log('‚úÖ Anime.js animation system ready');
                } else {
                    setTimeout(() => this.checkAnimeJS(), 100);
                }
            }
            
            processQueue() {
                this.animationQueue.forEach(animation => animation());
                this.animationQueue = [];
            }
            
            animate(config) {
                if (this.isAnimeLoaded) {
                    return anime(config);
                } else {
                    this.animationQueue.push(() => anime(config));
                    return null;
                }
            }
            
            // Professional page load sequence
            initializePageAnimations() {
                // 1. Fade in body
                document.body.classList.replace('loading', 'loaded');
                
                // 2. Hero section entrance
                this.animate({
                    targets: '#hero-content',
                    opacity: [0, 1],
                    translateY: [40, 0],
                    duration: 1200,
                    easing: 'easeOutCubic',
                    delay: 300
                });
                
                // 3. Scroll indicator
                this.animate({
                    targets: '#scroll-indicator',
                    opacity: [0, 1],
                    translateY: [20, 0],
                    duration: 800,
                    easing: 'easeOutQuad',
                    delay: 1600
                });
                
                // 4. Fixed elements
                this.animate({
                    targets: '.header-fixed',
                    opacity: [0, 1],
                    translateY: [-20, 0],
                    duration: 600,
                    easing: 'easeOutQuad',
                    delay: 800
                });
                
                // 5. Parameter groups staggered entrance
                this.animate({
                    targets: '.parameter-group',
                    opacity: [0, 1],
                    translateY: [30, 0],
                    duration: 800,
                    easing: 'easeOutQuad',
                    delay: anime.stagger(150, {start: 1200})
                });
                
                // 6. Results column
                this.animate({
                    targets: 'aside .card',
                    opacity: [0, 1],
                    translateX: [40, 0],
                    duration: 800,
                    easing: 'easeOutQuad',
                    delay: 1800
                });
            }
            
            // Value change animations - subtle and classy
            animateValueChange(element, newValue, oldValue) {
                if (!element) return;
                
                // Very subtle scale animation for emphasis
                this.animate({
                    targets: element,
                    scale: [1, 1.02, 1],
                    duration: 250,
                    easing: 'easeOutQuad'
                });
                
                // Subtle color flash for significant changes only
                if (Math.abs(newValue - oldValue) > (oldValue * 0.15)) {
                    element.style.background = 'rgba(59, 130, 246, 0.1)';
                    element.style.borderRadius = '4px';
                    element.style.padding = '2px 4px';
                    
                    this.animate({
                        targets: element,
                        background: ['rgba(59, 130, 246, 0.1)', 'transparent'],
                        duration: 800,
                        easing: 'easeOutQuad'
                    });
                }
            }
            
            // Chart update animations
            animateChartUpdate(chartElement) {
                this.animate({
                    targets: chartElement,
                    opacity: [0.7, 1],
                    scale: [0.98, 1],
                    duration: 400,
                    easing: 'easeOutQuad'
                });
            }
            
            // Professional loading states
            showLoadingState(element) {
                this.animate({
                    targets: element,
                    opacity: [1, 0.6],
                    scale: [1, 0.98],
                    duration: 200,
                    easing: 'easeOutQuad'
                });
            }
            
            hideLoadingState(element) {
                this.animate({
                    targets: element,
                    opacity: [0.6, 1],
                    scale: [0.98, 1],
                    duration: 300,
                    easing: 'easeOutQuad'
                });
            }
            
            // Micro-interactions
            addHoverAnimations() {
                // Button hover effects - subtle and classy
                document.querySelectorAll('.btn').forEach(btn => {
                    btn.addEventListener('mouseenter', () => {
                        this.animate({
                            targets: btn,
                            translateY: -0.5,
                            scale: 1.005,
                            duration: 200,
                            easing: 'easeOutQuad'
                        });
                    });
                    
                    btn.addEventListener('mouseleave', () => {
                        this.animate({
                            targets: btn,
                            translateY: 0,
                            scale: 1,
                            duration: 200,
                            easing: 'easeOutQuad'
                        });
                    });
                });
                
                // Card hover effects - subtle and classy
                document.querySelectorAll('.card').forEach(card => {
                    card.addEventListener('mouseenter', () => {
                        this.animate({
                            targets: card,
                            translateY: -1,
                            boxShadow: '0 8px 16px rgba(0,0,0,0.08)',
                            duration: 300,
                            easing: 'easeOutQuad'
                        });
                    });
                    
                    card.addEventListener('mouseleave', () => {
                        this.animate({
                            targets: card,
                            translateY: 0,
                            boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
                            duration: 300,
                            easing: 'easeOutQuad'
                        });
                    });
                });
            }
        }
        
        // Set up proper inheritance for Enhanced Calculator
        Object.getOwnPropertyNames(SocialMediaCalculator.prototype).forEach(name => {
            if (name !== 'constructor' && !SocialMediaCalculatorEnhanced.prototype.hasOwnProperty(name)) {
                SocialMediaCalculatorEnhanced.prototype[name] = SocialMediaCalculator.prototype[name];
            }
        });
        
        // Override updateDistributionChart with immediate updates for Enhanced Calculator
        SocialMediaCalculatorEnhanced.prototype.updateDistributionChart = function(paramName) {
            // Call original method immediately for better responsiveness
            SocialMediaCalculator.prototype.updateDistributionChart.call(this, paramName);
            
            // Only debounce the current value indicator updates
            clearTimeout(this.distributionUpdateTimeouts?.[paramName]);
            this.distributionUpdateTimeouts = this.distributionUpdateTimeouts || {};
            
            this.distributionUpdateTimeouts[paramName] = setTimeout(() => {
                this.updateCurrentValueIndicatorWithExpandedRange(paramName);
            }, 50); // Shorter debounce for indicator only
        };
        
        // Initialize enhanced animation system
        window.addEventListener('load', () => {
            // Create animation controller
            window.animationController = new AnimationController();
            
            // Initialize page animations
            setTimeout(() => {
                window.animationController.initializePageAnimations();
            }, 100);
            
            // Initialize performance monitoring
            setTimeout(() => {
                window.performanceMonitor = new PerformanceMonitor();
                window.performanceMonitor.startRealtimeMonitoring();
                
                // Add keyboard shortcut to toggle performance display
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                        e.preventDefault();
                        window.performanceMonitor.toggleDisplay();
                    }
                });
                
                console.log('‚úÖ Performance monitoring system active (Ctrl+Shift+P to toggle)');
            }, 200);
            
            // Initialize calculator with Lodash utilities
            setTimeout(() => {
                try {
                    window.calculator = new SocialMediaCalculatorEnhanced();
                    console.log('‚úÖ Enhanced calculator with Lodash utilities initialized');
                    window.calculatorType = 'enhanced';
                } catch (error) {
                    console.error('‚ùå Enhanced calculator initialization failed:', error);
                    // Only fallback if no calculator was created
                    if (!window.calculator) {
                        try {
                            window.calculator = new SocialMediaCalculator();
                            console.log('‚úÖ Basic calculator initialized as fallback');
                            window.calculatorType = 'basic';
                        } catch (fallbackError) {
                            console.error('‚ùå All calculator initialization failed:', fallbackError);
                        }
                    }
                }
                
                // Enhanced debug helper functions for distribution charts
                window.debugDistributionCharts = function() {
                    console.log('üîß Debug: FORCING DRAMATIC REFRESH of all distribution charts...');
                    if (window.calculator && window.calculator.refreshAllDistributionCharts) {
                        window.calculator.refreshAllDistributionCharts();
                        return 'All charts forcefully reshaped! Watch the curves change.';
                    } else {
                        console.error('‚ùå Calculator or refresh method not available');
                        return 'Error: Calculator not available';
                    }
                };
                
                window.debugSingleChart = function(paramName) {
                    console.log(`üîß Debug: DRAMATICALLY reshaping chart for ${paramName}...`);
                    if (window.calculator && window.calculator.updateDistributionChart) {
                        window.calculator.updateDistributionChart(paramName);
                        return `${paramName} chart dramatically reshaped around value ${window.calculator.parameters[paramName]}`;
                    } else {
                        console.error('‚ùå Calculator or update method not available');
                        return 'Error: Calculator not available';
                    }
                };
                
                window.debugDistributionSystem = function() {
                    console.log('üîß Debug: Running full distribution system diagnostic...');
                    if (window.calculator && window.calculator.debugDistributionSystem) {
                        return window.calculator.debugDistributionSystem();
                    } else {
                        console.error('‚ùå Calculator or debug method not available');
                        return 'Error: Calculator not available';
                    }
                };
                
                window.testDistributionChanges = function() {
                    console.log('üß™ Testing dramatic distribution changes...');
                    if (!window.calculator) {
                        return 'Error: Calculator not available';
                    }
                    
                    const testParams = ['vsl', 'attribution', 'suicides'];
                    const results = [];
                    
                    testParams.forEach(param => {
                        const oldValue = window.calculator.parameters[param];
                        
                        // Test different values to see curve changes
                        const testValues = param === 'vsl' ? [8, 13.7, 20] : 
                                          param === 'attribution' ? [5, 18, 30] : 
                                          [100000, 200000, 300000];
                        
                        testValues.forEach(value => {
                            window.calculator.parameters[param] = value;
                            window.calculator.updateDistributionChart(param);
                            window.calculator.updateCurrentValueIndicatorWithExpandedRange(param);
                            results.push(`${param} set to ${value} - curve reshaped, red line moved`);
                        });
                        
                        // Restore original value
                        window.calculator.parameters[param] = oldValue;
                        window.calculator.updateDistributionChart(param);
                        window.calculator.updateCurrentValueIndicatorWithExpandedRange(param);
                    });
                    
                    // Also test distribution info update
                    window.calculator.updateDistributionInfo();
                    results.push('Distribution info updated with evidence-based 95% CI');
                    
                    return results.join('\n');
                };
                
                window.testRedLineMovement = function() {
                    console.log('üî¥ Testing red line movement specifically...');
                    if (!window.calculator) {
                        return 'Error: Calculator not available';
                    }
                    
                    const param = 'vsl';
                    const testValues = [8, 11, 14, 17, 20];
                    const results = [];
                    
                    testValues.forEach(value => {
                        window.calculator.parameters[param] = value;
                        window.calculator.updateCurrentValueIndicatorWithExpandedRange(param);
                        
                        const redLine = document.getElementById(`${param}-current`);
                        const position = redLine ? redLine.style.left : 'not found';
                        results.push(`VSL=${value}M ‚Üí Red line at ${position}`);
                    });
                    
                    // Restore default
                    window.calculator.parameters[param] = 13.7;
                    window.calculator.updateCurrentValueIndicatorWithExpandedRange(param);
                    
                    return results.join('\n');
                };
                
                // NEW: Test dynamic CI calculations
                window.testDynamicCI = function() {
                    console.log('üìä Testing dynamic confidence interval calculations...');
                    if (!window.calculator) {
                        return 'Error: Calculator not available';
                    }
                    
                    const testParams = ['vsl', 'attribution', 'healthcare'];
                    const results = [];
                    
                    testParams.forEach(param => {
                        const oldValue = window.calculator.parameters[param];
                        
                        // Test different values to see CI changes
                        const testValues = param === 'vsl' ? [10, 13.7, 18] : 
                                          param === 'attribution' ? [10, 18, 25] : 
                                          [8000, 12000, 16000];
                        
                        testValues.forEach(value => {
                            window.calculator.parameters[param] = value;
                            window.calculator.updateDistributionInfo();
                            
                            const infoElement = document.getElementById(`${param}-info`);
                            const infoText = infoElement ? infoElement.textContent : 'not found';
                            results.push(`${param}=${value} ‚Üí ${infoText}`);
                        });
                        
                        // Restore original value
                        window.calculator.parameters[param] = oldValue;
                    });
                    
                    return results.join('\n');
                };
                
                // NEW: Test simplified distribution peak positioning
                window.testDistributionPeaks = function() {
                    console.log('üìà Testing simplified distribution peak positioning...');
                    if (!window.calculator) {
                        return 'Error: Calculator not available';
                    }
                    
                    const results = [];
                    const testParams = {
                        'vsl': [10, 13.7, 16],      // Normal distribution
                        'depression': [4000000, 5000000, 8000000]  // Skewed distribution
                    };
                    
                    Object.entries(testParams).forEach(([param, testValues]) => {
                        testValues.forEach(value => {
                            window.calculator.parameters[param] = value;
                            window.calculator.updateDistributionChart(param);
                            window.calculator.updateCurrentValueIndicatorWithExpandedRange(param);
                            
                            // Check if red line position roughly matches peak
                            const redLine = document.getElementById(`${param}-current`);
                            const position = redLine ? redLine.style.left : 'not found';
                            const distType = param === 'vsl' ? 'Normal' : 'Right-Skewed';
                            results.push(`${param}=${value} (${distType}) ‚Üí Red line at ${position}`);
                        });
                    });
                    
                    // Restore defaults
                    window.calculator.parameters.vsl = 13.7;
                    window.calculator.parameters.depression = 5000000;
                    window.calculator.updateDistributionChart('vsl');
                    window.calculator.updateDistributionChart('depression');
                    window.calculator.updateCurrentValueIndicatorWithExpandedRange('vsl');
                    window.calculator.updateCurrentValueIndicatorWithExpandedRange('depression');
                    
                    return results.join('\n');
                };
                
                console.log('Distribution System - Debug utilities available:');
                console.log('  debugDistributionCharts() - Refresh all distribution visualizations');
                console.log('  debugSingleChart(paramName) - Refresh specific chart');
                console.log('  debugDistributionSystem() - Full system diagnostic');
                console.log('  testDistributionChanges() - Test parameter responsiveness');
                console.log('  testRedLineMovement() - Test current value indicators');
                console.log('  testDynamicCI() - Test confidence interval calculations');
                console.log('  testDistributionPeaks() - Test distribution alignment');
            }, 500);
            
            // Add hover animations after DOM is ready
            setTimeout(() => {
                window.animationController.addHoverAnimations();
            }, 1000);
            
            // Initialize Mermaid for causal diagrams
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'default',
                    securityLevel: 'loose',
                    fontFamily: 'system-ui, -apple-system, sans-serif',
                    fontSize: 12
                });
            }
            
            // Set current year in footer
            const yearEl = document.getElementById('current-year');
            if (yearEl) yearEl.textContent = new Date().getFullYear();
            
            // Enhanced scroll effects with throttling and bounds checking
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        const scrolled = window.pageYOffset;
                        const heroSection = document.getElementById('hero-section');
                        const calculatorStart = document.getElementById('calculator-start');
                        
                        if (heroSection && calculatorStart) {
                            const heroHeight = heroSection.offsetHeight;
                            const scrollProgress = Math.min(scrolled / heroHeight, 1);
                            
                            // Gentle parallax effect with bounds
                            const opacity = Math.max(0.1, 1 - scrollProgress * 0.8);
                            const translateY = Math.min(scrolled * 0.2, heroHeight * 0.3);
                            
                            heroSection.style.opacity = opacity;
                            heroSection.style.transform = `translateY(${translateY}px)`;
                            
                            // Ensure calculator section stays on top
                            if (scrollProgress > 0.8) {
                                calculatorStart.style.transform = 'translateY(0)';
                                calculatorStart.style.zIndex = '10';
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        });
        
        // Additional utility functions - optimized resize handler
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (window.calculator && window.calculator.lastResults) {
                    // Throttle chart updates to reduce performance impact
                    console.log('üîÑ Window resized, updating charts only...');
                    window.calculator.updateChartsWithAnimation(window.calculator.lastResults);
                    
                    // Only recreate distribution charts if width changed significantly
                    const currentWidth = window.innerWidth;
                    if (!window.lastResizeWidth || Math.abs(currentWidth - window.lastResizeWidth) > 100) {
                        console.log('üìä Significant width change, updating distribution charts...');
                        const params = ['vsl', 'suicides', 'attribution', 'depression', 'yld', 'qol', 'healthcare', 'productivity', 'duration'];
                        // Only update 3 at a time to prevent long tasks
                        params.slice(0, 3).forEach(param => {
                            if (window.calculator.createDistributionChart) {
                                window.calculator.createDistributionChart(param);
                            }
                        });
                        setTimeout(() => {
                            params.slice(3, 6).forEach(param => {
                                if (window.calculator.createDistributionChart) {
                                    window.calculator.createDistributionChart(param);
                                }
                            });
                        }, 50);
                        setTimeout(() => {
                            params.slice(6).forEach(param => {
                                if (window.calculator.createDistributionChart) {
                                    window.calculator.createDistributionChart(param);
                                }
                            });
                        }, 100);
                        window.lastResizeWidth = currentWidth;
                    }
                }
            }, 500); // Increased delay to reduce frequency
        });
    </script>
    
    <!-- Clean Branding Component -->
    <div class="fixed-branding">
        <div class="text-xs text-gray-700 mb-1 font-medium">
            A <a href="http://www.subconscious.ai" target="_blank" class="text-blue-700 hover:text-blue-900 font-semibold transition-colors underline">Subconscious.ai</a> project
        </div>
        <div class="text-xs text-gray-600">
            Join our <a href="https://discord.gg/3bgj4ZhABz" target="_blank" class="text-purple-700 hover:text-purple-900 font-semibold transition-colors underline">Discord</a> for more research
        </div>
    </div>
</body>
</html> 